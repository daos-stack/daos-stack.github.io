<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="author" content="DAOS Project">
    <link rel="canonical" href="http://daos.io/development/">
    <link rel="shortcut icon" href="../img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>DAOS for Development - DAOS</title>
    <link href="../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../css/highlight.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../js/jquery-3.2.1.min.js"></script>
    <script src="../js/bootstrap-3.3.7.min.js"></script>
    <script src="../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "DAOS for Development", url: "#_top", children: [
          ]},
          {title: "Building DAOS for Development", url: "#building-daos-for-development", children: [
              {title: "Go dependencies", url: "#go-dependencies" },
              {title: "Protobuf Compiler", url: "#protobuf-compiler" },
          ]},
        ];

    </script>
    <script src="../js/base.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    

    <h1 id="daos-for-development">DAOS for Development</h1>
<h1 id="building-daos-for-development">Building DAOS for Development</h1>
<p>For development, it is recommended to build and install each dependency in a unique subdirectory. The DAOS build system supports this through the TARGET_PREFIX variable. Once the submodules have been initialized and updated, run the following:</p>
<pre><code>    scons PREFIX=${daos_prefix_path} TARGET_PREFIX=${daos_prefix_path}/opt install --build-deps=yes --config=force
</code></pre>

<p>Installing the components into seperate directories allow to upgrade the components individually replacing --build-deps=yes with --update-prereq={component_name}. This requires change to the environment configuration from before. For automated environment setup, source scons_local/utils/setup_local.sh.</p>
<pre><code>    ARGOBOTS=${daos_prefix_path}/opt/argobots
    CART=${daos_prefix_path}/opt/cart
    HWLOC=${daos_prefix_path}/opt/hwloc
    MERCURY=${daos_prefix_path}/opt/mercury
    PMDK=${daos_prefix_path}/opt/pmdk
    OMPI=${daos_prefix_path}/opt/ompi
    OPA=${daos_prefix_path}/opt/openpa
    PMIX=${daos_prefix_path}/opt/pmix
    FIO=${daos_prefix_path}/opt/fio
    SPDK=${daos_prefix_path}/opt/spdk

    PATH=$CART/bin/:$OMPI/bin/:${daos_prefix_path}/bin/:$PATH
</code></pre>

<p>With this approach DAOS would get built using the prebuilt dependencies in ${daos_prefix_path}/opt and required options are saved for future compilations. So, after the first time, during development, a mere "scons --config=force" and "scons --config=force install" would suffice for compiling changes to daos source code.</p>
<p>If you wish to compile DAOS with clang rather than gcc, set COMPILER=clang on the scons command line.   This option is also saved for future compilations.</p>
<h2 id="go-dependencies">Go dependencies</h2>
<p>Developers contributing Go code may need to change the external dependencies located in the src/control/vendor directory. The DAOS codebase uses <a href="https://github.com/golang/dep">dep</a> to manage these dependencies.</p>
<p>On EL7 and later:</p>
<pre><code>    yum install yum-plugin-copr
    yum copr enable hnakamur/golang-dep
    yum install golang-dep
</code></pre>

<p>On Fedora 27 and later:</p>
<pre><code>    dnf install dep
</code></pre>

<p>On Ubuntu 18.04 and later:</p>
<pre><code>    apt-get install go-dep
</code></pre>

<p>For OSes that don't supply a package:
* Ensure that you have a personal GOPATH (see "go env GOPATH", referred to as "$GOPATH" in this document) and a GOBIN ($GOPATH/bin) set up and included in your PATH:</p>
<pre><code>    mkdir -p $GOPATH/bin
    export PATH=$GOPATH/bin:$PATH
</code></pre>

<ul>
<li>Then follow the <a href="https://github.com/golang/dep">installation instructions on Github</a>.</li>
</ul>
<p>To update the vendor directory using dep after changing Gopkg.toml, first make sure DAOS is cloned into</p>
<pre><code>    $GOPATH/src/github.com/daos-stack/daos
</code></pre>

<p>Then:</p>
<pre><code>    cd $GOPATH/src/github.com/daos-stack/daos/src/control
    dep ensure
</code></pre>

<h2 id="protobuf-compiler">Protobuf Compiler</h2>
<p>The DAOS control plane infrastructure uses <a href="https://github.com/protocolbuffers/protobuf">Protocol Buffers</a> as the data serialization format for its RPC requests. Not all developers will need to compile the *.proto files, but if Protobuf changes are needed, the developer must regenerate the corresponding C and Go source files using a Protobuf compiler compatible with proto3 syntax.</p>
<h3 id="recommended-versions">Recommended Versions</h3>
<p>The recommended installation method is to clone the git repositories, check out the tagged releases noted below, and install from source. Later versions may work, but are not guaranteed.</p>
<ul>
<li><a href="https://github.com/protocolbuffers/protobuf">Protocol Buffers</a> v3.5.1. <a href="https://github.com/protocolbuffers/protobuf/blob/master/src/README.md">Installation instructions</a>.</li>
<li><a href="https://github.com/protobuf-c/protobuf-c">Protobuf-C</a> v1.3.1. <a href="https://github.com/protobuf-c/protobuf-c/blob/master/README.md">Installation instructions</a>.</li>
<li>gRPC plugin: <a href="https://github.com/golang/protobuf">protoc-gen-go</a> v1.2.0. <strong>Must match the proto version in src/control/Gopkg.toml.</strong> Install the specific version using GIT_TAG instructions <a href="https://github.com/golang/protobuf/blob/master/README.md">here</a>.</li>
</ul>
<h3 id="compiling-protobuf-files">Compiling Protobuf Files</h3>
<p>Generate the Go file using the gRPC plugin. You can designate the directory location:</p>
<pre><code>    protoc myfile.proto --go_out=plugins=grpc:&lt;go_file_dir&gt;
</code></pre>

<p>Generate the C files using Protobuf-C. As the header and source files in DAOS are typically kept in separate locations, you will need to move them manually to their destination directories:</p>
<pre><code>    protoc-c myfile.proto --c_out=.
    mv myfile.pb-c.h &lt;c_file_include_dir&gt;
    mv myfile.pb-c.c &lt;c_file_src_dir&gt;
</code></pre>

  <br>
    

    <br>
</div>

<footer class="col-md-12 wm-page-content">
      <p>
        <a href="https://github.com/daos-stack/daos/edit/master/docs/development.md">Edit on daos-stack/daos</a>
      </p>
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="https://github.com/gristlabs/mkdocs-windmill">Windmill</a> theme by Grist Labs.</p>
</footer>

</body>
</html>