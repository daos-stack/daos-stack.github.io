



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Distributed Asynchronous Object Storage">
      
      
        <link rel="canonical" href="http://daos.io/admin/deployment/">
      
      
        <meta name="author" content="DAOS Project">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.6.3">
    
    
      
        <title>System Deployment - DAOS v0.9</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.adb8469c.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/application-palette.a8b3c06d.css">
      
      
        
        
        <meta name="theme-color" content="#546e7a">
      
    
    
      <script src="../../assets/javascripts/modernizr.86422ebf.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
    
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="blue-grey" data-md-color-accent="blue">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#system-deployment" tabindex="0" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="http://daos.io" title="DAOS v0.9" aria-label="DAOS v0.9" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              DAOS v0.9
            </span>
            <span class="md-header-nav__topic">
              
                System Deployment
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" aria-label="search" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/daos-stack/daos/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    daos-stack/daos
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
        

  

<nav class="md-tabs md-tabs--active" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  <li class="md-tabs__item">
    
      <a href="../.." class="md-tabs__link">
        Home
      </a>
    
  </li>

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../overview/terminology/" class="md-tabs__link">
          Architecture Overview
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../hardware/" class="md-tabs__link md-tabs__link--active">
          Administration Guide
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../user/container/" class="md-tabs__link">
          User Guide
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="https://github.com/daos-stack/daos/blob/master/src/README.md" class="md-tabs__link">
          Internals (Developers)
        </a>
      
    </li>
  

      
        
      
        
      
    </ul>
  </div>
</nav>
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="http://daos.io" title="DAOS v0.9" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    DAOS v0.9
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/daos-stack/daos/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    daos-stack/daos
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Architecture Overview
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Architecture Overview
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../overview/terminology/" title="Terminology" class="md-nav__link">
      Terminology
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../overview/architecture/" title="Architecture" class="md-nav__link">
      Architecture
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../overview/storage/" title="Storage Model" class="md-nav__link">
      Storage Model
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../overview/transaction/" title="Transaction Model" class="md-nav__link">
      Transaction Model
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../overview/fault/" title="Fault Model" class="md-nav__link">
      Fault Model
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../overview/security/" title="Security Model" class="md-nav__link">
      Security Model
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" checked>
    
    <label class="md-nav__link" for="nav-3">
      Administration Guide
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Administration Guide
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../hardware/" title="Hardware Requirements" class="md-nav__link">
      Hardware Requirements
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../installation/" title="Software Installation" class="md-nav__link">
      Software Installation
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        System Deployment
      </label>
    
    <a href="./" title="System Deployment" class="md-nav__link md-nav__link--active">
      System Deployment
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#preflight-checklist" class="md-nav__link">
    Preflight Checklist
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#enable-iommu-optional" class="md-nav__link">
    Enable IOMMU (Optional)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#time-synchronization" class="md-nav__link">
    Time Synchronization
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#runtime-directory-setup" class="md-nav__link">
    Runtime Directory Setup
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#non-default-directory" class="md-nav__link">
    Non-default Directory
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#default-directory-non-persistent" class="md-nav__link">
    Default Directory (non-persistent)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#default-directory-persistent" class="md-nav__link">
    Default Directory (persistent)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elevated-privileges" class="md-nav__link">
    Elevated Privileges
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#privileged-helper-configuration" class="md-nav__link">
    Privileged Helper Configuration
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#daos-server-setup" class="md-nav__link">
    DAOS Server Setup
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#server-configuration-file" class="md-nav__link">
    Server Configuration File
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#configuration-options" class="md-nav__link">
    Configuration Options
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#certificate-configuration" class="md-nav__link">
    Certificate Configuration
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#server-startup" class="md-nav__link">
    Server Startup
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#parallel-launcher" class="md-nav__link">
    Parallel Launcher
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#systemd-integration" class="md-nav__link">
    Systemd Integration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kubernetes-pod" class="md-nav__link">
    Kubernetes Pod
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hardware-provisioning" class="md-nav__link">
    Hardware Provisioning
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scm-preparation" class="md-nav__link">
    SCM Preparation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#storage-selection" class="md-nav__link">
    Storage Selection
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network-configuration" class="md-nav__link">
    Network Configuration
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#storage-formatting" class="md-nav__link">
    Storage Formatting
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scm-format" class="md-nav__link">
    SCM Format
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nvme-format" class="md-nav__link">
    NVMe Format
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#server-format" class="md-nav__link">
    Server Format
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#agent-setup" class="md-nav__link">
    Agent Setup
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#agent-certificate-generation" class="md-nav__link">
    Agent Certificate Generation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#agent-configuration-file" class="md-nav__link">
    Agent Configuration File
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#agent-startup" class="md-nav__link">
    Agent Startup
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#system-validation" class="md-nav__link">
    System Validation
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../administration/" title="System Administration" class="md-nav__link">
      System Administration
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../pool_operations/" title="Pool Operations" class="md-nav__link">
      Pool Operations
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tiering_uns/" title="Tiering and Unified Namespace" class="md-nav__link">
      Tiering and Unified Namespace
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../performance_tuning/" title="Performance Tuning" class="md-nav__link">
      Performance Tuning
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../troubleshooting/" title="Troubleshooting" class="md-nav__link">
      Troubleshooting
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../utilities_examples/" title="Utilities and Usage Examples" class="md-nav__link">
      Utilities and Usage Examples
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../env_variables/" title="Environment Variables" class="md-nav__link">
      Environment Variables
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      User Guide
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        User Guide
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../user/container/" title="Container Management" class="md-nav__link">
      Container Management
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../user/interface/" title="Native Programming Interface" class="md-nav__link">
      Native Programming Interface
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../user/posix/" title="POSIX Namespace" class="md-nav__link">
      POSIX Namespace
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../user/hpc/" title="HPC I/O Middleware" class="md-nav__link">
      HPC I/O Middleware
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../user/spark/" title="Spark" class="md-nav__link">
      Spark
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Internals (Developers)
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Internals (Developers)
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="https://github.com/daos-stack/daos/blob/master/src/README.md" title="None" class="md-nav__link">
      None
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="https://wiki.hpdd.intel.com" title="Community Wiki" class="md-nav__link">
      Community Wiki
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="https://wiki.hpdd.intel.com/display/DC/Roadmap/" title="Roadmap" class="md-nav__link">
      Roadmap
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#preflight-checklist" class="md-nav__link">
    Preflight Checklist
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#enable-iommu-optional" class="md-nav__link">
    Enable IOMMU (Optional)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#time-synchronization" class="md-nav__link">
    Time Synchronization
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#runtime-directory-setup" class="md-nav__link">
    Runtime Directory Setup
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#non-default-directory" class="md-nav__link">
    Non-default Directory
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#default-directory-non-persistent" class="md-nav__link">
    Default Directory (non-persistent)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#default-directory-persistent" class="md-nav__link">
    Default Directory (persistent)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elevated-privileges" class="md-nav__link">
    Elevated Privileges
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#privileged-helper-configuration" class="md-nav__link">
    Privileged Helper Configuration
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#daos-server-setup" class="md-nav__link">
    DAOS Server Setup
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#server-configuration-file" class="md-nav__link">
    Server Configuration File
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#configuration-options" class="md-nav__link">
    Configuration Options
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#certificate-configuration" class="md-nav__link">
    Certificate Configuration
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#server-startup" class="md-nav__link">
    Server Startup
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#parallel-launcher" class="md-nav__link">
    Parallel Launcher
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#systemd-integration" class="md-nav__link">
    Systemd Integration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kubernetes-pod" class="md-nav__link">
    Kubernetes Pod
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hardware-provisioning" class="md-nav__link">
    Hardware Provisioning
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scm-preparation" class="md-nav__link">
    SCM Preparation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#storage-selection" class="md-nav__link">
    Storage Selection
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network-configuration" class="md-nav__link">
    Network Configuration
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#storage-formatting" class="md-nav__link">
    Storage Formatting
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scm-format" class="md-nav__link">
    SCM Format
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nvme-format" class="md-nav__link">
    NVMe Format
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#server-format" class="md-nav__link">
    Server Format
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#agent-setup" class="md-nav__link">
    Agent Setup
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#agent-certificate-generation" class="md-nav__link">
    Agent Certificate Generation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#agent-configuration-file" class="md-nav__link">
    Agent Configuration File
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#agent-startup" class="md-nav__link">
    Agent Startup
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#system-validation" class="md-nav__link">
    System Validation
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/daos-stack/daos/edit/master/docs/admin/deployment.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="system-deployment">System Deployment<a class="headerlink" href="#system-deployment" title="Permanent link">&para;</a></h1>
<p>The DAOS deployment workflow requires to start the DAOS server instances
early on to enable administrators to perform remote operations in parallel
across multiple storage nodes via the dmg management utility. Security is
guaranteed via the use of certificates.
The first type of commands run after installation include network and
storage hardware provisioning and would typically be run from a login
node.</p>
<p>After <code>daos_server</code> instances have been started on each storage node
for the first time, <code>dmg storage prepare</code> will set DCPM storage into the
necessary state for use with DAOS.
Then <code>dmg storage format</code> formats persistent storage devices
(specified in the server configuration file) on the storage nodes
and writes necessary metadata before starting DAOS I/O processes that
will operate across the fabric.</p>
<p>To sum up, the typical workflow of a DAOS system deployment consists of the
following steps:</p>
<ul>
<li>
<p>Configure and start the <a href="#daos-server-setup">DAOS server</a>.</p>
</li>
<li>
<p><a href="#hardware-provisioning">Provision Hardware</a> on all the storage nodes via the
  dmg utility.</p>
</li>
<li>
<p><a href="#storage-formatting">Format</a> the DAOS system</p>
</li>
<li>
<p><a href="#agent-configuration-and-startup">Set up and start the agent</a> on the client nodes</p>
</li>
<li>
<p><a href="#system-validation">Validate</a> that the DAOS system is operational</p>
</li>
</ul>
<p>Note that starting the DAOS server instances can be performed automatically
on boot if start-up scripts are registered with systemd.</p>
<p>The following subsections will cover each step in more detail.</p>
<p>Before getting started, please make sure to review and complete the
<a href="#preflight-checklist">pre-flight checklist</a> below.</p>
<h2 id="preflight-checklist">Preflight Checklist<a class="headerlink" href="#preflight-checklist" title="Permanent link">&para;</a></h2>
<p>This section covers the preliminary setup required on the compute and
storage nodes before deploying DAOS.</p>
<h3 id="enable-iommu-optional">Enable IOMMU (Optional)<a class="headerlink" href="#enable-iommu-optional" title="Permanent link">&para;</a></h3>
<p>In order to run DAOS server as a non-root user with NVMe devices, the hardware
must support virtualized device access, and it must be enabled in the system BIOS.
On Intel® systems, this capability is named Intel® Virtualization Technology for
Directed I/O (VT-d). Once enabled in BIOS, IOMMU support must also be enabled in
the Linux kernel. Exact details depend on the distribution, but the following
example should be illustrative:</p>
<pre><code class="bash"># Enable IOMMU on CentOS 7
# All commands must be run as root/sudo!

$ sudo vi /etc/default/grub # add the following line:
GRUB_CMDLINE_LINUX_DEFAULT=&quot;intel_iommu=on&quot;

# after saving the file, run the following to reconfigure
# the bootloader:
$ sudo grub2-mkconfig --output=/boot/grub2/grub.cfg

# if the command completed with no errors, reboot the system
# in order to make the changes take effect
$ sudo reboot
</code></pre>

<h3 id="time-synchronization">Time Synchronization<a class="headerlink" href="#time-synchronization" title="Permanent link">&para;</a></h3>
<p>The DAOS transaction model relies on timestamps and requires time to be
synchronized across all the storage and client nodes. This can be done
using NTP or any other equivalent protocol.</p>
<h3 id="runtime-directory-setup">Runtime Directory Setup<a class="headerlink" href="#runtime-directory-setup" title="Permanent link">&para;</a></h3>
<p>DAOS uses a series of Unix Domain Sockets to communicate between its
various components. On modern Linux systems, Unix Domain Sockets are
typically stored under /run or /var/run (usually a symlink to /run) and
are a mounted tmpfs file system. There are several methods for ensuring
the necessary directories are setup.</p>
<p>A sign that this step may have been missed is when starting daos_server
or daos_agent, you may see the message:</p>
<pre><code class="bash">$ mkdir /var/run/daos_server: permission denied
Unable to create socket directory: /var/run/daos_server
</code></pre>

<h4 id="non-default-directory">Non-default Directory<a class="headerlink" href="#non-default-directory" title="Permanent link">&para;</a></h4>
<p>By default, daos_server and daos_agent will use the directories
/var/run/daos_server and /var/run/daos_agent respectively. To change
the default location that daos_server uses for its runtime directory,
either uncomment and set the socket_dir configuration value in
install/etc/daos_server.yml, or pass the location to daos_server on
the command line using the -d flag. For the daos_agent, an alternate
location can be passed on the command line using the --runtime_dir flag.</p>
<h4 id="default-directory-non-persistent">Default Directory (non-persistent)<a class="headerlink" href="#default-directory-non-persistent" title="Permanent link">&para;</a></h4>
<p>Files and directories created in /run and /var/run only survive until
the next reboot. However, if reboots are infrequent, an easy solution
while still utilizing the default locations is to create the
required directories manually. To do this execute the following commands.</p>
<p>daos_server:</p>
<pre><code class="bash">$ mkdir /var/run/daos_server
$ chmod 0755 /var/run/daos_server
$ chown user:user /var/run/daos_server (where user is the user you
    will run daos_server as)
</code></pre>

<p>daos_agent:</p>
<pre><code class="bash">$ mkdir /var/run/daos_agent
$ chmod 0755 /var/run/daos_agent
$ chown user:user /var/run/daos_agent (where user is the user you
    will run daos_agent as)
</code></pre>

<h4 id="default-directory-persistent">Default Directory (persistent)<a class="headerlink" href="#default-directory-persistent" title="Permanent link">&para;</a></h4>
<p>If the server hosting daos_server or daos_agent will be rebooted often,
systemd provides a persistent mechanism for creating the required
directories called tmpfiles.d. This mechanism will be required every
time the system is provisioned and requires a reboot to take effect.</p>
<p>To tell systemd to create the necessary directories for DAOS:</p>
<ul>
<li>
<p>Copy the file utils/systemd/daosfiles.conf to /etc/tmpfiles.d\
    cp utils/systemd/daosfiles.conf /etc/tmpfiles.d</p>
</li>
<li>
<p>Modify the copied file to change the user and group fields
    (currently daos) to the user daos will be run as</p>
</li>
<li>
<p>Reboot the system, and the directories will be created automatically
    on all subsequent reboots.</p>
</li>
</ul>
<h3 id="elevated-privileges">Elevated Privileges<a class="headerlink" href="#elevated-privileges" title="Permanent link">&para;</a></h3>
<p>DAOS employs a privileged helper binary (<code>daos_admin</code>) to perform tasks
that require elevated privileges on behalf of <code>daos_server</code>.</p>
<h4 id="privileged-helper-configuration">Privileged Helper Configuration<a class="headerlink" href="#privileged-helper-configuration" title="Permanent link">&para;</a></h4>
<p>When DAOS is installed from RPM, the <code>daos_admin</code> helper is automatically installed
to the correct location with the correct permissions. The RPM creates a "daos_admins"
system group and configures permissions such that <code>daos_admin</code> may only be invoked
from <code>daos_server</code>.</p>
<p>For non-RPM installations, there are two supported scenarios:</p>
<ol>
<li><code>daos_server</code> is run as root, which means that <code>daos_admin</code> is also invoked as root,
and therefore no additional setup is necessary</li>
<li><code>daos_server</code> is run as a non-root user, which means that <code>daos_admin</code> must be
manually installed and configured</li>
</ol>
<p>The steps to enable the second scenario are as follows (steps are assumed to be
running out of a DAOS source tree which may be on a NFS share):</p>
<pre><code class="bash">$ chmod -x $SL_PREFIX/bin/daos_admin # prevent this copy from being executed
$ sudo cp $SL_PREFIX/bin/daos_admin /usr/bin/daos_admin
$ sudo chmod 4755 /usr/bin/daos_admin # make this copy setuid root
$ sudo mkdir -p /usr/share/daos/control # create symlinks to SPDK scripts
$ sudo ln -sf $SL_PREFIX/share/daos/control/setup_spdk.sh \
           /usr/share/daos/control
$ sudo mkdir -p /usr/share/spdk/scripts
$ sudo ln -sf $SL_PREFIX/share/spdk/scripts/setup.sh \
           /usr/share/spdk/scripts
$ sudo ln -sf $SL_PREFIX/share/spdk/scripts/common.sh \
           /usr/share/spdk/scripts
$ sudo ln -s $SL_PREFIX/include \
           /usr/share/spdk/include
</code></pre>

<p>NOTES:
 * The RPM installation is preferred for production scenarios. Manual installation
 is most appropriate for development and predeployment proof-of-concept scenarios.</p>
<h2 id="daos-server-setup">DAOS Server Setup<a class="headerlink" href="#daos-server-setup" title="Permanent link">&para;</a></h2>
<p>First of all, the DAOS server should be started to allow remote administration
command to be executed via the dmg tool. This section describes the minimal
DAOS server configuration and how to start it on all the storage nodes.</p>
<h3 id="server-configuration-file">Server Configuration File<a class="headerlink" href="#server-configuration-file" title="Permanent link">&para;</a></h3>
<p>The <code>daos_server</code> configuration file is parsed when starting the
<code>daos_server</code> process. The configuration file location can be specified
on the command line (<code>daos_server -h</code> for usage) or default location
(<code>install/etc/daos_server.yml</code>).</p>
<p>Parameter descriptions are specified in <a href="https://github.com/daos-stack/daos/blob/master/utils/config/daos_server.yml"><code>daos_server.yml</code></a>
and example configuration files in the <a href="https://github.com/daos-stack/daos/tree/master/utils/config/examples">examples</a>
directory.</p>
<p>Any option supplied to <code>daos_server</code> as a command line option or flag will
take precedence over equivalent configuration file parameter.</p>
<p>For convenience, active parsed configuration values are written to a temporary
file for reference, and the location will be written to the log.</p>
<h4 id="configuration-options">Configuration Options<a class="headerlink" href="#configuration-options" title="Permanent link">&para;</a></h4>
<p>The example configuration file lists the default empty configuration, listing all the
options (living documentation of the config file). Live examples are
available at
<a href="https://github.com/daos-stack/daos/tree/master/utils/config/examples">https://github.com/daos-stack/daos/tree/master/utils/config/examples</a></p>
<p>The location of this configuration file is determined by first checking
for the path specified through the -o option of the daos_server command
line. Otherwise, /etc/daos_server.conf is used.</p>
<p>Refer to the example configuration file (<a href="https://github.com/daos-stack/daos/blob/master/utils/config/daos_server.yml">daos_server.yml</a>)
for latest information and examples.</p>
<p>At this point of the process, the servers: and provider: section of the yaml
file can be left blank and will be populated in the subsequent sections.</p>
<h4 id="certificate-configuration">Certificate Configuration<a class="headerlink" href="#certificate-configuration" title="Permanent link">&para;</a></h4>
<p>The DAOS security framework relies on certificates to authenticate
components and administrators in addition to encrypting DAOS control plane
communications. A set of certificates for a given DAOS system may be
generated by running the <code>gen_certificates.sh</code> script provided with the DAOS
DAOS software if there is not an existing TLS certificate infrastructure.</p>
<p>When DAOS is installed from RPMs, this script is provided in the base <code>daos</code> RPM, and
may be invoked in the directory to which the certificates will be written. As part
of the generation process, a new local Certificate Authority is created to handle
certificate signing, and three role certificates are created:</p>
<pre><code># /usr/lib64/daos/certgen/gen_certificates.sh
Generating Private CA Root Certificate
Private CA Root Certificate created in ./daosCA
...
Generating Server Certificate
Required Server Certificate Files:
        ./daosCA/certs/daosCA.crt
        ./daosCA/certs/server.key
        ./daosCA/certs/server.crt
...
Generating Agent Certificate
Required Agent Certificate Files:
        ./daosCA/certs/daosCA.crt
        ./daosCA/certs/agent.key
        ./daosCA/certs/agent.crt
...
Generating Admin Certificate
Required Admin Certificate Files:
        ./daosCA/certs/daosCA.crt
        ./daosCA/certs/admin.key
        ./daosCA/certs/admin.crt
</code></pre>

<p>The files generated under ./daosCA should be protected from unauthorized access and
preserved for future use.</p>
<p>The generated keys and certificates must then be securely distributed to all nodes participating
in the DAOS system (servers, clients, and admin nodes). Permissions for these files should
be set to prevent unauthorized access to the keys and certificates.</p>
<p>After the certificates have been securely distributed, the DAOS configuration files must be
updated in order to enable authentication and secure communications. These examples assume
that the configuration files have been installed under <code>/etc/daos</code>:</p>
<pre><code class="yaml"># /etc/daos/daos_server.yml (servers)

transport_config:
  # Location where daos_server will look for Client certificates
  client_cert_dir: /etc/daos/clients
  # Custom CA Root certificate for generated certs
  ca_cert: /etc/daos/daosCA.crt
  # Server certificate for use in TLS handshakes
  cert: /etc/daos/server.crt
  # Key portion of Server Certificate
  key: /etc/daos/server.key
</code></pre>

<pre><code class="yaml"># /etc/daos/daos_agent.yml (clients)

transport_config:
  # Custom CA Root certificate for generated certs
  ca_cert: /etc/daos/daosCA.crt
  # Agent certificate for use in TLS handshakes
  cert: /etc/daos/agent.crt
  # Key portion of Agent Certificate
  key: /etc/daos/agent.key
</code></pre>

<pre><code class="yaml"># /etc/daos/daos.yml (dmg/admin)

transport_config:
  # Custom CA Root certificate for generated certs
  ca_cert: /etc/daos/daosCA.crt
  # Admin certificate for use in TLS handshakes
  cert: /etc/daos/admin.crt
  # Key portion of Admin Certificate
  key: /etc/daos/admin.key
</code></pre>

<h3 id="server-startup">Server Startup<a class="headerlink" href="#server-startup" title="Permanent link">&para;</a></h3>
<p>One instance of the <code>daos_server</code> process is to be started per
storage node. The server can be started either individually (e.g. independently
on each storage node via systemd) or collectively (e.g. pdsh, mpirun or as a
Kubernetes Pod).</p>
<h4 id="parallel-launcher">Parallel Launcher<a class="headerlink" href="#parallel-launcher" title="Permanent link">&para;</a></h4>
<p>Practically any parallel launcher can be used to start the DAOS server
collectively on a set of storage nodes. pdsh, clush and orterun are most
commonly used.</p>
<pre><code class="bash">$ clush -w &lt;server_list&gt; -o &quot;-t -t&quot; daos_server start -o &lt;config_file&gt;`
</code></pre>

<p>will launch <code>daos_server</code> on the specified hosts connecting to the <code>port</code>
parameter value specified in the server config file.
If the number of storage node exceed the default fanout value, then "-f"
followed by the number of storage nodes should be used.</p>
<p>Similarly, pdsh can be used:</p>
<pre><code class="bash">$ pdsh -w &lt;server_list&gt; daos_server start -o &lt;config_file&gt;`
</code></pre>

<p>As for orterun, the list of storage nodes can be specified on the command line
via the -H option. To start the DAOS server, run:</p>
<pre><code class="bash">$ orterun --map-by node --mca btl tcp,self --mca oob tcp -np &lt;num_servers&gt;
-H &lt;server_list&gt; --enable-recovery daos_server start -o &lt;config_file&gt;
</code></pre>

<p>The --enable-recovery is required for fault tolerance to guarantee that
the fault of one server does not cause the others to be stopped.</p>
<p>The --allow-run-as-root option can be added to the command line to
allow the daos_server to run with root privileges on each storage
nodes (for example when needing to perform privileged tasks relating
to storage format). See the orterun(1) man page for additional options.</p>
<h4 id="systemd-integration">Systemd Integration<a class="headerlink" href="#systemd-integration" title="Permanent link">&para;</a></h4>
<p>DAOS Server can be started as a systemd service. The DAOS Server
unit file is installed in the correct location when installing from RPMs.
If you wish to use systemd with a development build, you must copy the service
file from utils/systemd to /usr/lib/systemd/system. Once the file is copied
modify the ExecStart line to point to your in tree daos_server binary.</p>
<p>Once the service file is installed you can start daos_server
with the following commands:</p>
<pre><code class="bash">$ systemctl enable daos-server
$ systemctl start daos-server
</code></pre>

<p>To check the component status use:</p>
<pre><code class="bash">$ systemctl status daos-server
</code></pre>

<p>If DAOS Server failed to start, check the logs with:</p>
<pre><code class="bash">$ journalctl --unit daos-server
</code></pre>

<h4 id="kubernetes-pod">Kubernetes Pod<a class="headerlink" href="#kubernetes-pod" title="Permanent link">&para;</a></h4>
<p>DAOS service integration with Kubernetes is planned and will be
supported in a future DAOS version.</p>
<h2 id="hardware-provisioning">Hardware Provisioning<a class="headerlink" href="#hardware-provisioning" title="Permanent link">&para;</a></h2>
<p>Once the DAOS server started, the storage and network can be configured on the
storage nodes via the dmg utility.</p>
<h3 id="scm-preparation">SCM Preparation<a class="headerlink" href="#scm-preparation" title="Permanent link">&para;</a></h3>
<p>This section addresses how to verify that Optane DC Persistent Memory
Module (DCPMM) is correctly installed on the storage nodes, and how to configure
it in interleaved mode to be used by DAOS in AppDirect mode.
Instructions for other types of SCM may be covered in the future.</p>
<p>Provisioning the SCM occurs by configuring DCPM modules in AppDirect memory regions
(interleaved mode) in groups of modules local to a specific socket (NUMA), and
resultant nvdimm namespaces are defined by a device identifier (e.g., /dev/pmem0).</p>
<p>DCPM preparation is required once per DAOS installation and
requires the DAOS Control Servers to be running as root.</p>
<p>This step requires a reboot to enable DCPM resource allocation
changes to be read by BIOS.</p>
<p>DCPM preparation can be performed from the management tool
<code>dmg storage prepare --scm-only</code> or using the Control Server directly
<code>sudo daos_server storage prepare --scm-only</code>.</p>
<p>The first time the command is run, the SCM AppDirect regions will be created as
resource allocations on any available DCPM modules (one region per NUMA
node/socket). The regions are activated after BIOS reads the new resource
allocations, and after initial completion the command prints a
message to ask for a reboot (the command will not initiate reboot itself).</p>
<p>After running the command a reboot will be required, then the Control
Servers will then need to be started again and the command run for a
second time to expose the namespace device to be used by DAOS.</p>
<p>Example usage:</p>
<ul>
<li>
<p><code>dmg -l wolf-[118-121,130-133] -i storage prepare --scm-only</code>
after running, the user should be prompted for a reboot.</p>
</li>
<li>
<p><code>clush -w wolf-[118-121,130-133] reboot</code></p>
</li>
<li>
<p><code>clush -w wolf-[118-121,130-133] daos_server start -o utils/config/examples/daos_server_sockets.yml</code></p>
</li>
<li>
<p><code>dmg -l wolf-[118-121,130-133] -i storage prepare --scm-only</code>
after running, <code>/dev/pmemX</code> devices should be available on each of the hosts.</p>
</li>
</ul>
<p>'sudo daos_server storage prepare --scm-only' should be run for a second time after
system reboot to create the pmem kernel devices (/dev/pmemX
namespaces created on the new SCM regions).</p>
<p>On the second run, one namespace per region is created, and each namespace may
take up to a few minutes to create. Details of the pmem devices will be
displayed in JSON format on command completion.</p>
<p>Example output from the initial call (with the SCM modules set to default MemoryMode):</p>
<pre><code class="bash">Memory allocation goals for SCM will be changed and namespaces modified, this
will be a destructive operation.  ensure namespaces are unmounted and SCM is
otherwise unused.
A reboot is required to process new memory allocation goals.
</code></pre>

<p>Example output from the subsequent call (SCM modules configured to AppDirect
mode, and host rebooted):</p>
<pre><code class="bash">Memory allocation goals for SCM will be changed and namespaces modified. This
will be a destructive operation. Ensure namespaces are unmounted and the SCM
is otherwise unused.
creating SCM namespace, may take a few minutes...
creating SCM namespace, may take a few minutes...
Persistent memory kernel devices:
[{UUID:5d2f2517-9217-4d7d-9c32-70731c9ac11e Blockdev:pmem1 Dev:namespace1.0 NumaNode:1} {UUID:2bfe6c40-f79a-4b8e-bddf-ba81d4427b9b Blockdev:pmem0 Dev:namespace0.0 NumaNode:0}]
</code></pre>

<p>Upon successful creation of the pmem devices, DCPMM is properly configured and
one can move on to the next step.</p>
<p>If required, the pmem devices can be destroyed via the --reset option:</p>
<p><code>sudo daos_server [&lt;app_opts&gt;] storage prepare [--scm-only|-s] --reset [&lt;cmd_opts&gt;]</code></p>
<p>All namespaces are disabled and destroyed. The SCM regions are removed by
resetting modules into "MemoryMode" through resource allocations.</p>
<p>Note that undefined behavior may result if the namespaces/pmem kernel
devices are mounted before running reset (as per the printed warning).</p>
<p>A subsequent reboot is required for BIOS to read the new resource
allocations.</p>
<p>Example output when resetting the SCM modules:</p>
<pre><code class="bash">Memory allocation goals for SCM will be changed and namespaces modified, this
will be a destructive operation.  ensure namespaces are unmounted and SCM is
otherwise unused.
removing SCM namespace, may take a few minutes...
removing SCM namespace, may take a few minutes...
resetting SCM memory allocations
A reboot is required to process new memory allocation goals.
</code></pre>

<h3 id="storage-selection">Storage Selection<a class="headerlink" href="#storage-selection" title="Permanent link">&para;</a></h3>
<p>While the DAOS server auto-detects all the usable storage, the administrator
will still be provided with the ability through the configuration file
(see next section) to whitelist or blacklist the storage devices to be
(or not) used. This section covers how to manually detect the storage devices
potentially usable by DAOS to populate the configuration file when the
administrator wants to have finer control over the storage selection.</p>
<p><code>dmg storage scan</code> can be run to query remote running <code>daos_server</code>
processes over the management network.</p>
<p><code>sudo daos_server storage scan</code> can be used to query <code>daos_server</code>
directly (scans locally-attached SSDs and Intel Persistent Memory
Modules usable by DAOS).</p>
<pre><code class="bash">[daos@wolf-72 daos_m]$ dmg -l wolf-7[1-2] -i storage scan --verbose
wolf-[71-72]:10001: connected
------------
wolf-[71-72]
------------
SCM Namespace Socket ID Capacity
------------- --------- --------
pmem0         0         2.90TB
pmem1         1         2.90TB

NVMe PCI     Model                FW Revision Socket ID Capacity
--------     -----                ----------- --------- --------
0000:81:00.0 INTEL SSDPED1K750GA  E2010325    1         750.00GB
0000:87:00.0 INTEL SSDPEDMD016T4  8DV10171    1         1.56TB
0000:da:00.0 INTEL SSDPED1K750GA  E2010325    1         750.00GB
</code></pre>

<p>The NVMe PCI field above is what should be used in the server
configuration file to identified NVMe SSDs.</p>
<p>Devices with the same NUMA node/socket should be used in the same per-server
section of the server configuration file for best performance.</p>
<p>Note that other storage query commands are also available,
<code>dmg storage --help</code> for listings.</p>
<p>SSD health state can be verified via <code>dmg storage query nvme-health</code>:</p>
<pre><code class="bash">$ dmg -l wolf-71 storage query nvme-health
wolf-71:10001: connected
wolf-71:10001
        NVMe controllers and namespaces detail with health statistics:
                PCI:0000:81:00.0 Model:INTEL SSDPED1K750GA  FW:E2010325 Socket:1 Capacity:750TB
                Health Stats:
                        Temperature:288K(15C)
                        Controller Busy Time:5h26m0s
                        Power Cycles:4
                        Power On Duration:16488h0m0s
                        Unsafe Shutdowns:2
                        Media Errors:0
                        Error Log Entries:0
                        Critical Warnings:
                                Temperature: OK
                                Available Spare: OK
                                Device Reliability: OK
                                Read Only: OK
                                Volatile Memory Backup: OK
</code></pre>

<p>The next step consists of adjusting in the server configuration the storage
devices that should be used by DAOS. The <code>servers</code> section of the yaml is a
list specifying details for each DAOS I/O instance to be started on the host
(currently a maximum of 2 per host is imposed).</p>
<p>Devices with the same NUMA rating/node/socket should be colocated on
a single DAOS I/O instance where possible.
<a href="#server-configuration">more details</a></p>
<ul>
<li><code>bdev_list</code> should be populated with NVMe PCI addresses</li>
<li><code>scm_list</code> should be populated with DCPM interleaved set namespaces
(e.g. <code>/dev/pmem1</code>)</li>
<li>DAOS Control Servers will need to be restarted on all hosts after
updates to the server configuration file.</li>
<li>Pick one host in the system and set <code>access_points</code> to list of that
host's hostname or IP address (don't need to specify port).
This will be the host which bootstraps the DAOS management service
(MS).</li>
</ul>
<p>To illustrate, assume a cluster with homogenous hardware
configurations that returns the following from scan for each host:</p>
<pre><code class="bash">[daos@wolf-72 daos_m]$ dmg -l wolf-7[1-2] -i storage scan --verbose
wolf-7[1-2]:10001: connected
-------
wolf-7[1-2]
-------
SCM Namespace Socket ID Capacity
------------- --------- --------
pmem0         0         2.90TB
pmem1         1         2.90TB

NVMe PCI     Model                FW Revision Socket ID Capacity
--------     -----                ----------- --------- --------
0000:81:00.0 INTEL SSDPED1K750GA  E2010325    0         750.00GB
0000:87:00.0 INTEL SSDPEDMD016T4  8DV10171    0         1.56TB
0000:da:00.0 INTEL SSDPED1K750GA  E2010325    1         750.00GB
</code></pre>

<p>In this situation, the configuration file <code>servers</code> section could be
populated as follows:</p>
<pre><code>&lt;snip&gt;
port: 10001
access_points: [&quot;wolf-71&quot;] # &lt;----- updated
&lt;snip&gt;
servers:
-
  targets: 8                # count of storage targets per each server
  first_core: 0             # offset of the first core for service xstreams
  nr_xs_helpers: 2          # count of offload/helper xstreams per target
  fabric_iface: eth0        # map to OFI_INTERFACE=eth0
  fabric_iface_port: 31416  # map to OFI_PORT=31416
  log_mask: ERR             # map to D_LOG_MASK=ERR
  log_file: /tmp/server.log # map to D_LOG_FILE=/tmp/server.log
  env_vars:                 # influence DAOS IO Server behaviour by setting env variables
  - DAOS_MD_CAP=1024
  - CRT_CTX_SHARE_ADDR=0
  - CRT_TIMEOUT=30
  - FI_SOCKETS_MAX_CONN_RETRY=1
  - FI_SOCKETS_CONN_TIMEOUT=2000
  scm_mount: /mnt/daos  # map to -s /mnt/daos
  scm_class: dcpm
  scm_list: [/dev/pmem0] # &lt;----- updated
  bdev_class: nvme
  bdev_list: [&quot;0000:87:00.0&quot;, &quot;0000:81:00.0&quot;]  # &lt;----- updated
-
  targets: 8                # count of storage targets per each server
  first_core: 0             # offset of the first core for service xstreams
  nr_xs_helpers: 2          # count of offload/helper xstreams per target
  fabric_iface: eth0        # map to OFI_INTERFACE=eth0
  fabric_iface_port: 31416  # map to OFI_PORT=31416
  log_mask: ERR             # map to D_LOG_MASK=ERR
  log_file: /tmp/server.log # map to D_LOG_FILE=/tmp/server.log
  env_vars:                 # influence DAOS IO Server behaviour by setting env variables
  - DAOS_MD_CAP=1024
  - CRT_CTX_SHARE_ADDR=0
  - CRT_TIMEOUT=30
  - FI_SOCKETS_MAX_CONN_RETRY=1
  - FI_SOCKETS_CONN_TIMEOUT=2000
  scm_mount: /mnt/daos  # map to -s /mnt/daos
  scm_class: dcpm
  scm_list: [/dev/pmem1] # &lt;----- updated
  bdev_class: nvme
  bdev_list: [&quot;0000:da:00.0&quot;]  # &lt;----- updated
&lt;end&gt;
</code></pre>

<h3 id="network-configuration">Network Configuration<a class="headerlink" href="#network-configuration" title="Permanent link">&para;</a></h3>
<p>To display the fabric interface, OFI provider and NUMA node
combinations detected on the DAOS server, use the following command:</p>
<pre><code>$ daos_server network scan --all

        fabric_iface: ib0
        provider: ofi+psm2
        pinned_numa_node: 0

        fabric_iface: ib1
        provider: ofi+psm2
        pinned_numa_node: 1

        fabric_iface: ib0
        provider: ofi+verbs;ofi_rxm
        pinned_numa_node: 0

        fabric_iface: ib1
        provider: ofi+verbs;ofi_rxm
        pinned_numa_node: 1

        fabric_iface: ib0
        provider: ofi+verbs
        pinned_numa_node: 0

        fabric_iface: ib1
        provider: ofi+verbs
        pinned_numa_node: 1

        fabric_iface: ib0
        provider: ofi+sockets
        pinned_numa_node: 0

        fabric_iface: ib1
        provider: ofi+sockets
        pinned_numa_node: 1

        fabric_iface: eth0
        provider: ofi+sockets
        pinned_numa_node: 0

        fabric_iface: lo
        provider: ofi+sockets
        pinned_numa_node: 0
</code></pre>

<p>The network scan leverages data from libfabric.  Results are ordered from
highest performance at the top to lowest performance at the bottom of the list.
Once the fabric_iface and provider pair has been chosen, those items and the
pinned_numa_node may be inserted directly into the corresponding sections within
daos_server.yml.  Note that the provider is currently the same for all DAOS
IO server instances and is configured once in the server configuration.
The fabric_iface and pinned_numa_node are configured for each IO server
instance.</p>
<p>A list of providers that may be querried is found with the command:</p>
<pre><code class="bash">$ daos_server network list

Supported providers:
        ofi+gni, ofi+psm2, ofi+tcp, ofi+sockets, ofi+verbs, ofi_rxm
</code></pre>

<p>Performing a network scan that filters on a specific provider is accomplished
by issuing the following command:</p>
<pre><code class="bash">$ daos_server network scan --provider 'ofi+verbs;ofi_rxm'

Scanning fabric for cmdline specified provider: ofi+verbs;ofi_rxm
Fabric scan found 2 devices matching the provider spec: ofi+verbs;ofi_rxm

        fabric_iface: ib0
        provider: ofi+verbs;ofi_rxm
        pinned_numa_node: 0


        fabric_iface: ib1
        provider: ofi+verbs;ofi_rxm
        pinned_numa_node: 1
</code></pre>

<p>To aid in provider configuration and debug, it may be helpful to run the
fi_pingpong test (delivered as part of OFI/libfabric).  To run that test,
determine the name of the provider to test usually by removing the "ofi+" prefix from the network scan provider data.  Do use the "ofi+" prefix in the
daos_server.yml.  Do not use the "ofi+" prefix with fi_pingpong.</p>
<p>Then, the fi_pingpong test can be used to verify that the targeted OFI provider works fine:</p>
<pre><code class="bash">node1$ fi_pingpong -p psm2

node2$ fi_pingpong -p psm2 ${IP_ADDRESS_NODE1}

bytes #sent #ack total time  MB/sec  usec/xfer Mxfers/sec
64    10    =10  1.2k  0.00s 21.69   2.95      0.34
256   10    =10  5k    0.00s 116.36  2.20      0.45
1k    10    =10  20k   0.00s 379.26  2.70      0.37
4k    10    =10  80k   0.00s 1077.89 3.80      0.26
64k   10    =10  1.2m  0.00s 2145.20 30.55     0.03
1m    10    =10  20m   0.00s 8867.45 118.25    0.01
</code></pre>

<h2 id="storage-formatting">Storage Formatting<a class="headerlink" href="#storage-formatting" title="Permanent link">&para;</a></h2>
<p>Once the <code>daos_server</code> has been restarted with the correct storage devices and
network interface to use, one can move to the format phase.
When <code>daos_server</code> is started for the first time, it enters "maintenance mode"
and waits for a <code>dmg storage format</code> call to be issued from the management tool.
This remote call will trigger the formatting of the locally attached storage on
the host for use with DAOS using the parameters defined in the server config file.</p>
<p><code>dmg -i -l &lt;host:port&gt;[,...] storage format</code> will normally be run on a login
node specifying a hostlist (<code>-l &lt;host:port&gt;[,...]</code>) of storage nodes with SCM/DCPM
modules and NVMe SSDs installed and prepared.</p>
<p>Upon successful format, DAOS Control Servers will start DAOS IO
instances that have been specified in the server config file.</p>
<p>Successful start-up is indicated by the following on stdout:
<code>DAOS I/O server (v0.8.0) process 433456 started on rank 1 with 8 target, 2 helper XS per target, firstcore 0, host wolf-72.wolf.hpdd.intel.com.</code></p>
<h3 id="scm-format">SCM Format<a class="headerlink" href="#scm-format" title="Permanent link">&para;</a></h3>
<p>When the command is run, the pmem kernel devices created on SCM/DCPM regions are
formatted and mounted based on the parameters provided in the server config file.</p>
<ul>
<li><code>scm_mount</code> specifies the location of the mountpoint to create.</li>
<li><code>scm_class</code> can be set to <code>ram</code> to use a tmpfs in the situation that no SCM/DCPM
is available (scm_size dictates the size of tmpfs in GB), when set to <code>dcpm</code> the device
specified under <code>scm_list</code> will be mounted at <code>scm_mount</code> path.</li>
</ul>
<h3 id="nvme-format">NVMe Format<a class="headerlink" href="#nvme-format" title="Permanent link">&para;</a></h3>
<p>When the command is run, NVMe SSDs are formatted and set up to be used by DAOS
based on the parameters provided in the server config file.</p>
<p><code>bdev_class</code> can be set to <code>nvme</code> to use actual NVMe devices with SPDK for DAOS
storage.
Other <code>bdev_class</code> values can be used for emulation of NVMe storage as specified
in the server config file.
<code>bdev_list</code> identifies devices to use with a list of PCI addresses (this can be
populated after viewing results from <code>storage scan</code> command).</p>
<p>After the format command is run, the path specified by the server configuration
file <code>scm_mount</code> parameter should be mounted and should contain a file named
<code>daos_nvme.conf</code>.
The file should describe the devices with PCI addresses as listed in the
<code>bdev_list</code> parameter of the server config file.
The presence and contents of the file indicate that the specified NVMe SSDs have
been configured correctly for use with DAOS.</p>
<p>The contents of the NVMe SSDs listed in the server configuration file <code>bdev_list</code>
parameter will be reset on format.</p>
<h3 id="server-format">Server Format<a class="headerlink" href="#server-format" title="Permanent link">&para;</a></h3>
<p>Before the format command is run, no DAOS metadata should exist under the
path specified by <code>scm_mount</code> parameter in the server configuration file.</p>
<p>After the <code>storage format</code> command is run, the path specified by the server
configuration file <code>scm_mount</code> parameter should be mounted and should contain
the necessary DAOS metadata indicating that the server has been formatted.</p>
<p>When starting, <code>daos_server</code> will skip <code>maintenance mode</code> and attempt to start
IO services if valid DAOS metadata is found in <code>scm_mount</code>.</p>
<h2 id="agent-setup">Agent Setup<a class="headerlink" href="#agent-setup" title="Permanent link">&para;</a></h2>
<p>This section addresses how to configure the DAOS agents on the storage
nodes before starting it.</p>
<h3 id="agent-certificate-generation">Agent Certificate Generation<a class="headerlink" href="#agent-certificate-generation" title="Permanent link">&para;</a></h3>
<p>The DAOS security framework relies on certificates to authenticate
administrators. The security infrastructure is currently under
development and will be delivered in DAOS v1.0. Initial support for certificates
has been added to DAOS and can be disabled either via the command line or in the
DAOS Agent configuration file. Currently, the easiest way to disable certificate
support is to pass the -i flag to daos_agent.</p>
<h3 id="agent-configuration-file">Agent Configuration File<a class="headerlink" href="#agent-configuration-file" title="Permanent link">&para;</a></h3>
<p>The <code>daos_agent</code> configuration file is parsed when starting the
<code>daos_agent</code> process. The configuration file location can be specified
on the command line (<code>daos_agent -h</code> for usage) or default location
(<code>install/etc/daos_agent.yml</code>).</p>
<p>Parameter descriptions are specified in <a href="https://github.com/daos-stack/daos/blob/master/utils/config/daos_agent.yml">daos_agent.yml</a>.</p>
<p>Any option supplied to <code>daos_agent</code> as a command line option or flag will
take precedence over equivalent configuration file parameter.</p>
<p>For convenience, active parsed config values are written to a temporary
file for reference, and the location will be written to the log.</p>
<p>The following section lists the format, options, defaults, and
descriptions available in the configuration file.</p>
<p>The example configuration file lists the default empty configuration listing all the
options (living documentation of the config file). Live examples are
available at
<a href="https://github.com/daos-stack/daos/tree/master/utils/config">https://github.com/daos-stack/daos/tree/master/utils/config</a></p>
<p>The location of this configuration file is determined by first checking
for the path specified through the -o option of the daos_agent command
line. Otherwise, /etc/daos_agent.conf is used.</p>
<p>Refer to the example configuration file (<a href="https://github.com/daos-stack/daos/blob/master/utils/config/daos_server.yml">daos_server.yml</a>)
for latest information and examples.</p>
<h3 id="agent-startup">Agent Startup<a class="headerlink" href="#agent-startup" title="Permanent link">&para;</a></h3>
<p>DAOS Agent is a standalone application to be run on each compute node.
It can be configured to use secure communications (default) or can be allowed
to communicate with the control plane over unencrypted channels. The following
example shows daos_agent being configured to operate in insecure mode due to
incomplete integration of certificate support as of the 0.6 release.</p>
<p>To start the DAOS Agent from the command line, run:</p>
<pre><code class="bash">$ daos_agent -i
</code></pre>

<p>Alternatively, the DAOS Agent can be started as a systemd service. The DAOS Agent
unit file is installed in the correct location when installing from RPMs.
If you wish to use systemd with a development build, you must copy the service
file from utils/systemd to /usr/lib/systemd/system. Once the file is copied
modify the ExecStart line to point to your in tree daos_agent binary.</p>
<p>Once the service file is installed, you can start daos_agent
with the following commands:</p>
<pre><code class="bash">$ systemctl enable daos-agent
$ systemctl start daos-agent
</code></pre>

<p>To check the component status use:</p>
<pre><code class="bash">$ systemctl status daos-agent
</code></pre>

<p>If DAOS Agent failed to start check the logs with:</p>
<pre><code class="bash">$ journalctl --unit daos-agent
</code></pre>

<h2 id="system-validation">System Validation<a class="headerlink" href="#system-validation" title="Permanent link">&para;</a></h2>
<p>To validate that the DAOS system is properly installed, the daos_test
suite can be executed. Ensure the DAOS Agent is configured and running before
running daos_test and that the DAOS_SINGLETON_CLI and CRT_ATTACH_INFO_PATH
environment variables are properly set as described <a href="#server-startup">here</a>.</p>
<pre><code class="bash">mpirun -np &lt;num_clients&gt; --hostfile &lt;hostfile&gt; ./daos_test
</code></pre>

<p>daos_test requires at least 8GB of SCM (or DRAM with tmpfs) storage on
each storage node.</p>
<div class="footnote">
<hr />
<ol>
<li id="fn:1">
<p>https://github.com/intel/ipmctl&#160;<a class="footnote-backref" href="#fnref:1" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
<li id="fn:2">
<p>https://github.com/daos-stack/daos/tree/master/utils/config&#160;<a class="footnote-backref" href="#fnref:2" title="Jump back to footnote 2 in the text">&#8617;</a></p>
</li>
<li id="fn:3">
<p><a href="https://www.open-mpi.org/faq/?category=running#mpirun-hostfile"><em>https://www.open-mpi.org/faq/?category=running#mpirun-hostfile</em></a>&#160;<a class="footnote-backref" href="#fnref:3" title="Jump back to footnote 3 in the text">&#8617;</a></p>
</li>
<li id="fn:4">
<p>https://github.com/daos-stack/daos/tree/master/src/control/README.md&#160;<a class="footnote-backref" href="#fnref:4" title="Jump back to footnote 4 in the text">&#8617;</a></p>
</li>
</ol>
</div>
                
                  
                
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../installation/" title="Software Installation" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Software Installation
              </span>
            </div>
          </a>
        
        
          <a href="../administration/" title="System Administration" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                System Administration
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org" target="_blank" rel="noopener">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.c33a9706.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
      
    
  </body>
</html>