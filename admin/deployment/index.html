<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <meta name="author" content="DAOS Project">
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>System Deployment - DAOS v0.8</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>
  <link href='https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "System Deployment";
    var mkdocs_page_input_path = "admin/deployment.md";
    var mkdocs_page_url = "/admin/deployment/";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> DAOS v0.8</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="tocbase current">
    
    
      


  <li class="navtree toctree-l1 inactive">
    <a class="" href="../..">Home</a>
  </li>
    
      
  <li class="navtree toctree-l1 label">
    <p class="caption">Overview</p>
  </li>


  

  
    <li class="navtree toctree-l1 group">
      <ul class="navtree subnav-l1 current">
          


  <li class="navtree toctree-l2 inactive">
    <a class="" href="../../overview/terminology/">Terminology</a>
  </li>
        
          


  <li class="navtree toctree-l2 inactive">
    <a class="" href="../../overview/storage/">Storage Model</a>
  </li>
        
          


  <li class="navtree toctree-l2 inactive">
    <a class="" href="../../overview/transaction/">Transaction Model</a>
  </li>
        
          


  <li class="navtree toctree-l2 inactive">
    <a class="" href="../../overview/fault/">Fault Model</a>
  </li>
        
          


  <li class="navtree toctree-l2 inactive">
    <a class="" href="../../overview/security/">Security Model</a>
  </li>
        
      </ul>
    </li>
    
      
  <li class="navtree toctree-l1 label">
    <p class="caption">Administration Guide</p>
  </li>


  

  
    <li class="navtree toctree-l1 group">
      <ul class="navtree subnav-l1 current">
          


  <li class="navtree toctree-l2 inactive">
    <a class="" href="../intro/">Introduction</a>
  </li>
        
          


  <li class="navtree toctree-l2 inactive">
    <a class="" href="../architecture/">DAOS Architecture</a>
  </li>
        
          


  <li class="navtree toctree-l2 inactive">
    <a class="" href="../hardware/">Hardware Requirements</a>
  </li>
        
          


  <li class="navtree toctree-l2 inactive">
    <a class="" href="../installation/">Software Installation</a>
  </li>
        
          


  
    
    <li class="navtree toctree-l2 page current">
      <a class="current" href="./">
        System Deployment
          <span class="toctree-expand"></span>
      </a>
    </li>
    
      



  <li class="toctree-l2 current">
    <ul class="subnav-l2 current">
    
      
          

  <li class="toctree-l3 current with-children">
    <a href="#preflight-checklist">
      Preflight Checklist
      <span class="toctree-expand"></span>
    </a>
  </li>



  <li class="toctree-l3 current">
    <ul class="subnav-l3 current">
    
      
        <li class="toctree-l4">
          <a class="toctree-l5" href="#time-synchronization">Time Synchronization</a>
        </li>
    
      
          

  <li class="toctree-l4">
    <a href="#runtime-directory-setup">
      Runtime Directory Setup
      <span class="toctree-expand"></span>
    </a>
  </li>



  <li class="toctree-l4">
    <ul class="subnav-l4 toc-hidden">
    
      
        <li class="toctree-l5">
          <a class="toctree-l6" href="#non-default-directory">Non-default Directory</a>
        </li>
    
      
        <li class="toctree-l5">
          <a class="toctree-l6" href="#default-directory-non-persistent">Default Directory (non-persistent)</a>
        </li>
    
      
        <li class="toctree-l5">
          <a class="toctree-l6" href="#default-directory-persistent">Default Directory (persistent)</a>
        </li>
    
    </ul>
  </li>

      
    
      
        <li class="toctree-l4">
          <a class="toctree-l5" href="#elevated-privileges">Elevated Privileges</a>
        </li>
    
    </ul>
  </li>

      
    
      
          

  <li class="toctree-l3">
    <a href="#typical-workflow">
      Typical Workflow
      <span class="toctree-expand"></span>
    </a>
  </li>



  <li class="toctree-l3">
    <ul class="subnav-l3 toc-hidden">
    
      
        <li class="toctree-l4">
          <a class="toctree-l5" href="#step-1-create-or-copy-server-configuration-file">Step 1. Create or copy server configuration file</a>
        </li>
    
      
        <li class="toctree-l4">
          <a class="toctree-l5" href="#step-2-start-daos-control-servers">Step 2. Start DAOS Control Servers</a>
        </li>
    
      
        <li class="toctree-l4">
          <a class="toctree-l5" href="#step-3-prepare-dcpm-modules-for-use-with-daos">Step 3. Prepare DCPM modules for use with DAOS</a>
        </li>
    
      
        <li class="toctree-l4">
          <a class="toctree-l5" href="#step-4-scan-storage-to-check-device-details-and-state">Step 4. Scan Storage to check device details and state</a>
        </li>
    
      
        <li class="toctree-l4">
          <a class="toctree-l5" href="#step-5-add-device-identifiers-to-server-config-file">Step 5. Add device identifiers to server config file</a>
        </li>
    
      
        <li class="toctree-l4">
          <a class="toctree-l5" href="#step-6-format-storage-from-any-node">Step 6. Format Storage (from any node)</a>
        </li>
    
      
        <li class="toctree-l4">
          <a class="toctree-l5" href="#step-7-optional-reset-daos-storage">Step 7. (optional) Reset DAOS storage</a>
        </li>
    
    </ul>
  </li>

      
    
      
          

  <li class="toctree-l3">
    <a href="#hardware-provisioning">
      Hardware Provisioning
      <span class="toctree-expand"></span>
    </a>
  </li>



  <li class="toctree-l3">
    <ul class="subnav-l3 toc-hidden">
    
      
          

  <li class="toctree-l4 current with-children">
    <a href="#storage-preparation">
      Storage Preparation
      <span class="toctree-expand"></span>
    </a>
  </li>



  <li class="toctree-l4 current">
    <ul class="subnav-l4 current">
    
      
        <li class="toctree-l5">
          <a class="toctree-l6" href="#scm-preparation">SCM Preparation</a>
        </li>
    
      
        <li class="toctree-l5">
          <a class="toctree-l6" href="#nvme-preparation">NVMe Preparation</a>
        </li>
    
    </ul>
  </li>

      
    
      
        <li class="toctree-l4">
          <a class="toctree-l5" href="#storage-detection-selection">Storage Detection &amp; Selection</a>
        </li>
    
      
        <li class="toctree-l4">
          <a class="toctree-l5" href="#network-interface-detection-and-selection">Network Interface Detection and Selection</a>
        </li>
    
    </ul>
  </li>

      
    
      
          

  <li class="toctree-l3">
    <a href="#server-configuration">
      Server Configuration
      <span class="toctree-expand"></span>
    </a>
  </li>



  <li class="toctree-l3">
    <ul class="subnav-l3 toc-hidden">
    
      
        <li class="toctree-l4">
          <a class="toctree-l5" href="#certificate-generation">Certificate Generation</a>
        </li>
    
      
          

  <li class="toctree-l4">
    <a href="#server-configuration-file">
      Server Configuration File
      <span class="toctree-expand"></span>
    </a>
  </li>



  <li class="toctree-l4">
    <ul class="subnav-l4 toc-hidden">
    
      
        <li class="toctree-l5">
          <a class="toctree-l6" href="#configuration-file-options">Configuration File Options</a>
        </li>
    
    </ul>
  </li>

      
    
    </ul>
  </li>

      
    
      
          

  <li class="toctree-l3">
    <a href="#server-startup">
      Server Startup
      <span class="toctree-expand"></span>
    </a>
  </li>



  <li class="toctree-l3">
    <ul class="subnav-l3 toc-hidden">
    
      
        <li class="toctree-l4">
          <a class="toctree-l5" href="#parallel-launcher">Parallel Launcher</a>
        </li>
    
      
        <li class="toctree-l4">
          <a class="toctree-l5" href="#systemd-integration">Systemd Integration</a>
        </li>
    
      
        <li class="toctree-l4">
          <a class="toctree-l5" href="#kubernetes-pod">Kubernetes Pod</a>
        </li>
    
      
        <li class="toctree-l4">
          <a class="toctree-l5" href="#internal-daos-control-server-components">Internal DAOS Control Server Components</a>
        </li>
    
    </ul>
  </li>

      
    
      
          

  <li class="toctree-l3">
    <a href="#storage-formatting">
      Storage Formatting
      <span class="toctree-expand"></span>
    </a>
  </li>



  <li class="toctree-l3">
    <ul class="subnav-l3 toc-hidden">
    
      
        <li class="toctree-l4">
          <a class="toctree-l5" href="#scm-format">SCM Format</a>
        </li>
    
      
        <li class="toctree-l4">
          <a class="toctree-l5" href="#nvme-format">NVMe Format</a>
        </li>
    
      
        <li class="toctree-l4">
          <a class="toctree-l5" href="#server-format">Server Format</a>
        </li>
    
    </ul>
  </li>

      
    
      
          

  <li class="toctree-l3">
    <a href="#agent-configuration">
      Agent Configuration
      <span class="toctree-expand"></span>
    </a>
  </li>



  <li class="toctree-l3">
    <ul class="subnav-l3 toc-hidden">
    
      
        <li class="toctree-l4">
          <a class="toctree-l5" href="#agent-certificate-generation">Agent Certificate Generation</a>
        </li>
    
      
          

  <li class="toctree-l4">
    <a href="#agent-configuration-file">
      Agent Configuration File
      <span class="toctree-expand"></span>
    </a>
  </li>



  <li class="toctree-l4">
    <ul class="subnav-l4 toc-hidden">
    
      
        <li class="toctree-l5">
          <a class="toctree-l6" href="#configuration-file-options_1">Configuration File Options</a>
        </li>
    
    </ul>
  </li>

      
    
    </ul>
  </li>

      
    
      
        <li class="toctree-l3">
          <a class="toctree-l4" href="#agent-startup">Agent Startup</a>
        </li>
    
      
        <li class="toctree-l3">
          <a class="toctree-l4" href="#system-validation">System Validation</a>
        </li>
    
    </ul>
  </li>


  
        
          


  <li class="navtree toctree-l2 inactive">
    <a class="" href="../administration/">System Administration</a>
  </li>
        
          


  <li class="navtree toctree-l2 inactive">
    <a class="" href="../pool_operations/">Pool Operations</a>
  </li>
        
          


  <li class="navtree toctree-l2 inactive">
    <a class="" href="../app_interface_tiering/">Application Interface and Tiering</a>
  </li>
        
          


  <li class="navtree toctree-l2 inactive">
    <a class="" href="../performance_tuning/">Performance Tuning</a>
  </li>
        
          


  <li class="navtree toctree-l2 inactive">
    <a class="" href="../troubleshooting/">Troubleshooting</a>
  </li>
        
          


  <li class="navtree toctree-l2 inactive">
    <a class="" href="../utilities_examples/">Utilities and Usage Examples</a>
  </li>
        
          


  <li class="navtree toctree-l2 inactive">
    <a class="" href="../env_variables/">Environment Variables</a>
  </li>
        
      </ul>
    </li>
    
  </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">DAOS v0.8</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Administration Guide &raquo;</li>
        
      
    
    <li>System Deployment</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/daos-stack/daos/edit/master/docs/admin/deployment.md"> Edit on daos-stack/daos</a>
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="system-deployment">System Deployment</h1>
<h2 id="preflight-checklist">Preflight Checklist</h2>
<p>This section covers the preliminary setup required on the compute and
storage nodes before deploying DAOS.</p>
<h3 id="time-synchronization">Time Synchronization</h3>
<p>The DAOS transaction model relies on timestamps and requires time to be
synchronized across all the storage and client nodes. This can be done
using NTP or any other equivalent protocol.</p>
<h3 id="runtime-directory-setup">Runtime Directory Setup</h3>
<p>DAOS uses a series of Unix Domain Sockets to communicate between its
various components. On modern Linux systems, Unix Domain Sockets are
typically stored under /run or /var/run (usually a symlink to /run) and
are a mounted tmpfs file system. There are several methods for ensuring
the necessary directories are setup.</p>
<p>A sign that this step may have been missed is when starting daos_server
or daos_agent, you may see the message:</p>
<pre><code>$ mkdir /var/run/daos_server: permission denied
Unable to create socket directory: /var/run/daos_server
</code></pre>

<h4 id="non-default-directory">Non-default Directory</h4>
<p>By default, daos_server and daos_agent will use the directories
/var/run/daos_server and /var/run/daos_agent respectively. To change
the default location that daos_server uses for its runtime directory,
either uncomment and set the socket_dir configuration value in
install/etc/daos_server.yml, or pass the location to daos_server on
the command line using the -d flag. For the daos_agent, an alternate
location can be passed on the command line using the --runtime_dir flag.</p>
<h4 id="default-directory-non-persistent">Default Directory (non-persistent)</h4>
<p>Files and directories created in /run and /var/run only survive until
the next reboot. However, if reboots are infrequent, an easy solution
while still utilizing the default locations is to create the
required directories manually. To do this execute the following commands.</p>
<p>daos_server:</p>
<pre><code>$ mkdir /var/run/daos_server
$ chmod 0755 /var/run/daos_server
$ chown user:user /var/run/daos_server (where user is the user you
    will run daos_server as)
</code></pre>

<p>daos_agent:</p>
<pre><code>$ mkdir /var/run/daos_agent
$ chmod 0755 /var/run/daos_agent
$ chown user:user /var/run/daos_agent (where user is the user you
    will run daos_agent as)
</code></pre>

<h4 id="default-directory-persistent">Default Directory (persistent)</h4>
<p>If the server hosting daos_server or daos_agent will be rebooted often,
systemd provides a persistent mechanism for creating the required
directories called tmpfiles.d. This mechanism will be required every
time the system is provisioned and requires a reboot to take effect.</p>
<p>To tell systemd to create the necessary directories for DAOS:</p>
<ul>
<li>
<p>Copy the file utils/systemd/daosfiles.conf to /etc/tmpfiles.d\
    cp utils/systemd/daosfiles.conf /etc/tmpfiles.d</p>
</li>
<li>
<p>Modify the copied file to change the user and group fields
    (currently daos) to the user daos will be run as</p>
</li>
<li>
<p>Reboot the system, and the directories will be created automatically
    on all subsequent reboots.</p>
</li>
</ul>
<h3 id="elevated-privileges">Elevated Privileges</h3>
<p>DAOS employs a privileged helper binary (<code>daos_admin</code>) to perform tasks
that require elevated privileges on behalf of <code>daos_server</code>.</p>
<p>Due to limitations introduced by recent security fixes in the kernel,
DAOS I/O processes are also required to run with elevated privileges
in order to access NVMe SSDs through the SPDK framework.</p>
<p>This is a temporary requirement that will be mitigated by moving to
use VFIO driver with SPDK (requires IOMMU enabled) rather than UIO.</p>
<h2 id="typical-workflow">Typical Workflow</h2>
<p>DAOS Control Server (<a href="/src/control/server"><code>daos_server</code></a>) instances will
listen for requests from the management tool (<a href="/src/control/cmd/dmg"><code>dmg</code></a>),
enabling users to perform remote operations in parallel across
multiple storage nodes.
The first type of commands run after installation include network and
storage hardware provisioning and would typically be run from a login
node.</p>
<p>After <code>daos_server</code> instances have been started on each storage node
for the first time (using a parallel launcher), <code>dmg storage prepare</code>
will set DCPM storage into the necessary state for use with DAOS.
Then <code>dmg storage format</code> formats persistent storage devices
(specified in the server configuration file) on the storage nodes
and writes necessary metadata before starting DAOS I/O processes that
will operate across the fabric.</p>
<p>Typically an administrator will perform the following steps:</p>
<ol>
<li>Create or copy server configuration file</li>
<li>Start DAOS Control Servers (one per host)</li>
<li>Prepare DCPM modules for use with DAOS (one-time only, requires reboot)</li>
<li>Scan storage to check device details and state</li>
<li>Update device identifiers in server configuration file</li>
<li>Format storage (DAOS I/O processes will be auto-started after format)</li>
<li>(Optional) Reset DAOS storage</li>
</ol>
<p>Note that starting the DAOS Control Server instances can be performed
automatically on boot if start-up scripts are registered with systemd.</p>
<p>The following subsections will cover each step in more detail.</p>
<h3 id="step-1-create-or-copy-server-configuration-file">Step 1. Create or copy server configuration file</h3>
<p>Example configuration files can be found in the
<a href="https://github.com/daos-stack/daos/blob/master/utils/config/examples">examples directory</a>
and description of the parameters in
<a href="https://github.com/daos-stack/daos/blob/master/utils/config/daos_server.yml"><code>daos_server.yml</code></a>.</p>
<h3 id="step-2-start-daos-control-servers">Step 2. Start DAOS Control Servers</h3>
<p>One instance of the <code>daos_server</code> process is to be started per
storage node (please complete the
<a href="#preflight-checklist">pre-flight checklist</a> first).</p>
<p>This is typically performed using a parallel launcher, for the
examples in this document, <code>clush</code> will be used.</p>
<p><code>clush -w wolf-[118-121,130-133] daos_server start -o utils/config/examples/daos_server_sockets.yml</code>
will launch <code>daos_server</code> on the specified hosts connecting to
the <code>port</code> parameter value specified in the server config file.</p>
<p>Note that the DAOS Control Servers can be started automatically on
boot with systemd. Practically any parallel launcher can be used
e.g. pdsh, orterun.</p>
<h3 id="step-3-prepare-dcpm-modules-for-use-with-daos">Step 3. Prepare DCPM modules for use with DAOS</h3>
<p>DCPM preparation is required once per DAOS installation and
requires the DAOS Control Servers to be running as root.</p>
<p>This step requires a reboot to enable DCPM resource allocation
changes to be read by BIOS.</p>
<p>DCPM preparation can be performed from the management tool
<code>dmg storage prepare --scm-only</code> or using the Control Server directly
<code>sudo daos_server storage prepare --scm-only</code>.</p>
<p>After running the command a reboot will be required, then the Control
Servers will then need to be started again and the command run for a
second time to expose the namespace device to be used by DAOS.
(<a href="#scm-preparation">more details</a>)</p>
<p>Example usage:
- <code>dmg -l wolf-[118-121,130-133] -i storage prepare --scm-only</code>
after running, the user should be prompted for a reboot.
- <code>clush -w wolf-[118-121,130-133] reboot</code>
- <code>clush -w wolf-[118-121,130-133] daos_server start -o utils/config/examples/daos_server_sockets.yml</code>
- <code>dmg -l wolf-[118-121,130-133] -i storage prepare --scm-only</code>
after running, <code>/dev/pmemX</code> devices should be available on each of the hosts.</p>
<h3 id="step-4-scan-storage-to-check-device-details-and-state">Step 4. Scan Storage to check device details and state</h3>
<ul>
<li><code>dmg -l wolf-[118-121,130-133] -i storage scan [--verbose]</code>
will display details of NVMe and DCPM devices on the specified hosts that can be used with DAOS.
<a href="#storage-detection--selection">more details</a></li>
</ul>
<p>Note that other storage query commands are also available,
<code>dmg storage --help</code> for listings.</p>
<h3 id="step-5-add-device-identifiers-to-server-config-file">Step 5. Add device identifiers to server config file</h3>
<p>Edit <code>$DAOS_SRC/utils/config/examples/daos_server_sockets.yml</code>
to update the server configuration file with the information
received from scan to instruct which devices to use.
The <code>servers</code> section is a list specifying details for each DAOS I/O
instance to be started on the host (currently a maximum of 2 per host
is imposed).
Devices with the same NUMA rating/node/socket should be colocated on
a single DAOS I/O instance where possible.
<a href="#server-configuration">more details</a></p>
<ul>
<li><code>bdev_list</code> should be populated with NVMe PCI addresses</li>
<li><code>scm_list</code> should be populated with DCPM interleaved set namespaces
(e.g. <code>/dev/pmem1</code>)</li>
<li>DAOS Control Servers will need to be restarted on all hosts after
updates to the server configuration file.</li>
<li>Pick one host in the system and set <code>access_points</code> to host and
listening port (probably going to be the same as server config <code>port</code>
parameter).
This will be the host which bootstraps the DAOS management service
(MS).</li>
</ul>
<p>To illustrate, assume a cluster with homogenous hardware
configurations that returns the following from scan for each host:</p>
<pre><code>[daos@wolf-72 daos_m]$ dmg -l wolf-7[1-2] -i storage scan --verbose
wolf-7[1-2]:10001: connected
-------
wolf-7[1-2]
-------
SCM Namespace Socket ID Capacity
------------- --------- --------
pmem0         0         2.90TB
pmem1         1         2.90TB

NVMe PCI     Model                FW Revision Socket ID Capacity
--------     -----                ----------- --------- --------
0000:81:00.0 INTEL SSDPED1K750GA  E2010325    0         750.00GB
0000:87:00.0 INTEL SSDPEDMD016T4  8DV10171    0         1.56TB
0000:da:00.0 INTEL SSDPED1K750GA  E2010325    1         750.00GB
</code></pre>

<p>In this situation, the configuration file <code>servers</code> section could be
populated as follows:</p>
<pre><code>&lt;snip&gt;
port: 10001
access_points: [&quot;wolf-71:10001&quot;] # &lt;----- updated
&lt;snip&gt;
servers:
-
  targets: 8                # count of storage targets per each server
  first_core: 0             # offset of the first core for service xstreams
  nr_xs_helpers: 2          # count of offload/helper xstreams per target
  fabric_iface: eth0        # map to OFI_INTERFACE=eth0
  fabric_iface_port: 31416  # map to OFI_PORT=31416
  log_mask: ERR             # map to D_LOG_MASK=ERR
  log_file: /tmp/server.log # map to D_LOG_FILE=/tmp/server.log
  env_vars:                 # influence DAOS IO Server behaviour by setting env variables
  - DAOS_MD_CAP=1024
  - CRT_CTX_SHARE_ADDR=0
  - CRT_TIMEOUT=30
  - FI_SOCKETS_MAX_CONN_RETRY=1
  - FI_SOCKETS_CONN_TIMEOUT=2000
  scm_mount: /mnt/daos  # map to -s /mnt/daos
  scm_class: dcpm
  scm_list: [/dev/pmem0] # &lt;----- updated
  bdev_class: nvme
  bdev_list: [&quot;0000:87:00.0&quot;, &quot;0000:81:00.0&quot;]  # &lt;----- updated
-
  targets: 8                # count of storage targets per each server
  first_core: 0             # offset of the first core for service xstreams
  nr_xs_helpers: 2          # count of offload/helper xstreams per target
  fabric_iface: eth0        # map to OFI_INTERFACE=eth0
  fabric_iface_port: 31416  # map to OFI_PORT=31416
  log_mask: ERR             # map to D_LOG_MASK=ERR
  log_file: /tmp/server.log # map to D_LOG_FILE=/tmp/server.log
  env_vars:                 # influence DAOS IO Server behaviour by setting env variables
  - DAOS_MD_CAP=1024
  - CRT_CTX_SHARE_ADDR=0
  - CRT_TIMEOUT=30
  - FI_SOCKETS_MAX_CONN_RETRY=1
  - FI_SOCKETS_CONN_TIMEOUT=2000
  scm_mount: /mnt/daos  # map to -s /mnt/daos
  scm_class: dcpm
  scm_list: [/dev/pmem1] # &lt;----- updated
  bdev_class: nvme
  bdev_list: [&quot;0000:da:00.0&quot;]  # &lt;----- updated
&lt;end&gt;
</code></pre>

<h3 id="step-6-format-storage-from-any-node">Step 6. Format Storage (from any node)</h3>
<ul>
<li>Assuming <code>daos_server</code> is running on all desired hosts (see step
2) and is in <code>format</code> mode (<code>SCM format required</code> displayed on DAOS
Control Server stdout).</li>
<li><code>dmg -l wolf-[118-121,130-133] -i storage format</code> will create
necessary metadata on the SCM mount at the path specified in the
config file. The device specified in the config file (<code>scm_list</code>)
will be mounted at the given path.
The NVMe devices specified in the config file (<code>bdev_list</code>) will be
formatted using SPDK (Optane drives may take a while) and configuration
written to each SCM mount to enable DAOS I/O instances to use designated
SSDs through SPDK.</li>
<li><a href="/src/control/cmd/dmg/README.md#storage-format">management tool details</a></li>
<li><a href="/src/control/server/README.md#scm-format">SCM specific details</a></li>
<li><a href="/src/control/server/README.md#nvme-format">NVMe specific details</a></li>
</ul>
<p>After successful format, DAOS Control Servers will start DAOS IO
instances that have been specified in the server config file.</p>
<p>Successful start-up is indicated by the following on stdout:
<code>DAOS I/O server (v0.8.0) process 433456 started on rank 1 with 8 target, 2 helper XS per target, firstcore 0, host wolf-72.wolf.hpdd.intel.com.</code></p>
<h3 id="step-7-optional-reset-daos-storage">Step 7. (optional) Reset DAOS storage</h3>
<p>To reset the DAOS metadata across all hosts the system must be reformatted.
First ensure all <code>daos_server</code> processes on all hosts have been
stopped, then for each SCM mount specified in the config file
(<code>scm_mount</code> in the <code>servers</code> section) umount and wipe FS signatures.</p>
<p>Example illustration with two IO instances specified in the config file:
- <code>clush -w wolf-[118-121,130-133] umount /mnt/daos1</code>
- <code>clush -w wolf-[118-121,130-133] umount /mnt/daos0</code>
- <code>clush -w wolf-[118-121,130-133] wipefs -a /dev/pmem1</code>
- <code>clush -w wolf-[118-121,130-133] wipefs -a /dev/pmem0</code>
- Then restart DAOS Control Servers (step #2) and format (step #6).</p>
<h2 id="hardware-provisioning">Hardware Provisioning</h2>
<h3 id="storage-preparation">Storage Preparation</h3>
<h4 id="scm-preparation">SCM Preparation</h4>
<p>This section addresses how to verify that Optane DC Persistent Memory
(DCPM) is correctly installed on the storage nodes, and how to configure
it in interleaved mode to be used by DAOS in AppDirect mode.
Instructions for other types of SCM may be covered in the future.</p>
<p>Provisioning the SCM occurs by configuring DCPM modules in AppDirect memory regions
(interleaved mode) in groups of modules local to a specific socket (NUMA), and
resultant nvdimm namespaces are defined by a device identifier (e.g., /dev/pmem0).</p>
<p>DCPM can be configured and managed through the
<a href="https://github.com/intel/ipmctl">ipmctl</a> library and associated tool. The
ipmctl command can be run as root and has detailed man pages and
help output (use "ipmctl help" to display it).</p>
<p>The list of NVDIMMs can be displayed as follows:</p>
<pre><code>ipmctl show -dimm
</code></pre>

<table>
<thead>
<tr>
<th>DimmID</th>
<th>Capacity</th>
<th>HealthState</th>
<th>ActionRequired</th>
<th>LockState</th>
<th>FWVersion</th>
</tr>
</thead>
<tbody>
<tr>
<td>0x0001</td>
<td>502.5 GiB</td>
<td>Healthy</td>
<td>0</td>
<td>Disabled</td>
<td>01.00.00.5127</td>
</tr>
<tr>
<td>0x0101</td>
<td>502.5 GiB</td>
<td>Healthy</td>
<td>0</td>
<td>Disabled</td>
<td>01.00.00.5127</td>
</tr>
<tr>
<td>0x1001</td>
<td>502.5 GiB</td>
<td>Healthy</td>
<td>0</td>
<td>Disabled</td>
<td>01.00.00.5127</td>
</tr>
<tr>
<td>0x1101</td>
<td>502.5 GiB</td>
<td>Healthy</td>
<td>0</td>
<td>Disabled</td>
<td>01.00.00.5127</td>
</tr>
</tbody>
</table>
<p>Moreover, DAOS requires DCPM to be configured in interleaved mode. A
storage subcommand (prepare --scm-only) can be used as a "command mode"
invocation of <em>daos_server</em> and must be run as root. SCM modules will
be configured into interleaved regions with memory mode set to
"AppDirect" mode with one set per socket (each module is assigned to a socket,
and reports this via its NUMA rating).</p>
<p><code>sudo daos_server [&lt;app_opts&gt;] storage prepare [--scm-only|-s] [&lt;cmd_opts&gt;]</code>
The first time the command is run, the SCM AppDirect regions will be created as
resource allocations on any available DCPM modules (one region per NUMA
node/socket). The regions are activated after BIOS reads the new resource
allocations, and after initial completion the command prints a
message to ask for a reboot (the command will not initiate reboot itself).</p>
<p>'sudo daos_server storage prepare --scm-only' should be run for a second time after
system reboot to create the pmem kernel devices (/dev/pmemX
namespaces created on the new SCM regions).</p>
<p>One namespace per region is created, and each namespace may take up to a few
minutes to create. Details of the pmem devices will be displayed in JSON format
on command completion.</p>
<p>Example output from the initial call (with the SCM modules set to default MemoryMode):</p>
<pre><code class="bash">Memory allocation goals for SCM will be changed and namespaces modified, this
will be a destructive operation.  ensure namespaces are unmounted and SCM is
otherwise unused.
A reboot is required to process new memory allocation goals.
</code></pre>

<p>Example output from the subsequent call (SCM modules configured to AppDirect
mode, and host rebooted):</p>
<pre><code class="bash">Memory allocation goals for SCM will be changed and namespaces modified. This
will be a destructive operation. Ensure namespaces are unmounted and the SCM
is otherwise unused.
creating SCM namespace, may take a few minutes...
creating SCM namespace, may take a few minutes...
Persistent memory kernel devices:
[{UUID:5d2f2517-9217-4d7d-9c32-70731c9ac11e Blockdev:pmem1 Dev:namespace1.0 NumaNode:1} {UUID:2bfe6c40-f79a-4b8e-bddf-ba81d4427b9b Blockdev:pmem0 Dev:namespace0.0 NumaNode:0}]
</code></pre>

<p><code>sudo daos_server [&lt;app_opts&gt;] storage prepare [--scm-only|-s] --reset [&lt;cmd_opts&gt;]</code></p>
<p>All namespaces are disabled and destroyed. The SCM regions are removed by
resetting modules into "MemoryMode" through resource allocations.</p>
<p>Note that undefined behavior may result if the namespaces/pmem kernel
devices are mounted before running reset (as per the printed warning).</p>
<p>A subsequent reboot is required for BIOS to read the new resource
allocations.</p>
<p>Example output when resetting the SCM modules:</p>
<pre><code class="bash">Memory allocation goals for SCM will be changed and namespaces modified, this
will be a destructive operation.  ensure namespaces are unmounted and SCM is
otherwise unused.
removing SCM namespace, may take a few minutes...
removing SCM namespace, may take a few minutes...
resetting SCM memory allocations
A reboot is required to process new memory allocation goals.
</code></pre>

<h4 id="nvme-preparation">NVMe Preparation</h4>
<p>DAOS supports only NVMe-capable SSDs that are accessed directly from
userspace through the SPDK library.</p>
<p>NVMe access through SPDK as an unprivileged user can be enabled by
running the example command
<code>sudo daos_server storage prepare --nvme-only -p 4096 -u bob</code>.</p>
<p>This will perform the required setup in order for <code>daos_server</code> to be run
by user "bob" who will own the hugepage mountpoint directory and vfio
groups as needed in SPDK operations.</p>
<p>If the target-user is unspecified (<code>-u</code> short option), the target user
will be the issuer of the sudo command (or root if not using sudo).</p>
<p>The specification of hugepages (<code>-p</code> short option) defines the number
of huge pages to allocate for use by SPDK.</p>
<p>A list of PCI addresses can also be supplied to avoid unbinding all
PCI devices from the kernel, using the <code>-w</code> / <code>--pci-whitelist</code> option.</p>
<p>The <code>sudo daos_server [&lt;app_opts&gt;] storage prepare [--nvme-only|-n] [&lt;cmd_opts&gt;]</code>
command wraps the SPDK setup script to unbind the devices from
original kernel drivers and then binds the devices to a UIO driver
through which SPDK can communicate.</p>
<p>When a PCI address whitelist is not specified, SPDK access to all SSDs
will be enabled for the user (either the user executing sudo, the user
specified as --target-user, or effective user - in that order of precedence)
involving changing the ownership of relevant files in addition to SPDK setup.</p>
<p>The devices can then be bound back to the original drivers with the command
<code>sudo daos_server [&lt;app_opts&gt;] storage prepare [--nvme-only|-n] --reset [&lt;cmd_opts&gt;]</code>.</p>
<h3 id="storage-detection-selection">Storage Detection &amp; Selection</h3>
<p>While the DAOS server auto-detects all the usable
storage, the administrator will still be provided with the ability through
the configuration file (see next section) to whitelist or blacklist the
storage devices to be (or not) used. This section covers how to manually
detect the storage devices potentially usable by DAOS to
populate the configuration file when the administrator wants to have
finer control over the storage selection.</p>
<p><code>dmg storage scan</code> can be run to query remote running <code>daos_server</code>
processes over the management network.</p>
<p><code>sudo daos_server storage scan</code> can be used to query <code>daos_server</code>
directly (scans locally-attached SSDs and Intel Persistent Memory
Modules usable by DAOS).</p>
<pre><code class="bash">[daos@wolf-72 daos_m]$ dmg -l wolf-7[1-2] -i storage scan --verbose
wolf-[71-72]:10001: connected
------------
wolf-[71-72]
------------
SCM Namespace Socket ID Capacity
------------- --------- --------
pmem0         0         2.90TB
pmem1         1         2.90TB

NVMe PCI     Model                FW Revision Socket ID Capacity
--------     -----                ----------- --------- --------
0000:81:00.0 INTEL SSDPED1K750GA  E2010325    1         750.00GB
0000:87:00.0 INTEL SSDPEDMD016T4  8DV10171    1         1.56TB
0000:da:00.0 INTEL SSDPED1K750GA  E2010325    1         750.00GB
</code></pre>

<p>The NVMe PCI field above is what should be used in the server
configuration file to identified NVMe SSDs.</p>
<p>Devices with the same NUMA node/socket should be used in the same per-server
section of the server configuration file for best performance.</p>
<h3 id="network-interface-detection-and-selection">Network Interface Detection and Selection</h3>
<p>To display the fabric interface, OFI provider and NUMA node
combinations detected on the DAOS server, use the following command:</p>
<pre><code>$ daos_server network scan --all

        fabric_iface: ib0
        provider: ofi+psm2
        pinned_numa_node: 0


        fabric_iface: ib1
        provider: ofi+psm2
        pinned_numa_node: 1


        fabric_iface: ib0
        provider: ofi+verbs;ofi_rxm
        pinned_numa_node: 0


        fabric_iface: ib1
        provider: ofi+verbs;ofi_rxm
        pinned_numa_node: 1


        fabric_iface: ib0
        provider: ofi+verbs
        pinned_numa_node: 0


        fabric_iface: ib1
        provider: ofi+verbs
        pinned_numa_node: 1


        fabric_iface: ib0
        provider: ofi+sockets
        pinned_numa_node: 0


        fabric_iface: ib1
        provider: ofi+sockets
        pinned_numa_node: 1


        fabric_iface: eth0
        provider: ofi+sockets
        pinned_numa_node: 0


        fabric_iface: lo
        provider: ofi+sockets
        pinned_numa_node: 0
</code></pre>

<p>The network scan leverages data from libfabric.  Results are ordered from
highest performance at the top to lowest performance at the bottom of the list.
Once the fabric_iface and provider pair has been chosen, those items and the
pinned_numa_node may be inserted directly into the corresponding sections within
daos_server.yml.  Note that the provider is currently the same for all DAOS
IO server instances and is configured once in the server configuration.  The fabric_iface and pinned_numa_node are configured for each IO server instance.</p>
<p>A list of providers that may be querried is found with the command:</p>
<pre><code>$ daos_server network list

Supported providers:
        ofi+gni, ofi+psm2, ofi+tcp, ofi+sockets, ofi+verbs, ofi_rxm
</code></pre>

<p>Performing a network scan that filters on a specific provider is accomplished
by issuing the following command:</p>
<pre><code>$ daos_server network scan --provider 'ofi+verbs;ofi_rxm'

Scanning fabric for cmdline specified provider: ofi+verbs;ofi_rxm
Fabric scan found 2 devices matching the provider spec: ofi+verbs;ofi_rxm

        fabric_iface: ib0
        provider: ofi+verbs;ofi_rxm
        pinned_numa_node: 0


        fabric_iface: ib1
        provider: ofi+verbs;ofi_rxm
        pinned_numa_node: 1
</code></pre>

<p>To aid in provider configuration and debug, it may be helpful to run the
fi_pingpong test (delivered as part of OFI/libfabric).  To run that test,
determine the name of the provider to test usually by removing the "ofi+" prefix from the network scan provider data.  Do use the "ofi+" prefix in the
daos_server.yml.  Do not use the "ofi+" prefix with fi_pingpong.</p>
<p>Then, the fi_pingpong test can be used to verify that the targeted OFI provider works fine:</p>
<pre><code>node1$ fi_pingpong -p psm2

node2$ fi_pingpong -p psm2 ${IP_ADDRESS_NODE1}

bytes #sent #ack total time  MB/sec  usec/xfer Mxfers/sec
64    10    =10  1.2k  0.00s 21.69   2.95      0.34
256   10    =10  5k    0.00s 116.36  2.20      0.45
1k    10    =10  20k   0.00s 379.26  2.70      0.37
4k    10    =10  80k   0.00s 1077.89 3.80      0.26
64k   10    =10  1.2m  0.00s 2145.20 30.55     0.03
1m    10    =10  20m   0.00s 8867.45 118.25    0.01
</code></pre>

<h2 id="server-configuration">Server Configuration</h2>
<p>This section addresses how to configure the DAOS servers on the storage
nodes before starting it.</p>
<h3 id="certificate-generation">Certificate Generation</h3>
<p>The DAOS security framework relies on certificates to authenticate
administrators. The security infrastructure is currently under
development and will be delivered in DAOS v1.0. Initial support for certificates
has been added to DAOS and can be disabled either via the command line or in the
DAOS server configuration file. Currently, the easiest way to disable certificate
support is to pass the -i flag to daos_server.</p>
<h3 id="server-configuration-file">Server Configuration File</h3>
<p>The <code>daos_server</code> configuration file is parsed when starting the
<code>daos_server</code> process. The configuration file location can be specified
on the command line (<code>daos_server -h</code> for usage) or default location
(<code>install/etc/daos_server.yml</code>).</p>
<p>Parameter descriptions are specified in <a href="https://github.com/daos-stack/daos/blob/master/utils/config/daos_server.yml"><code>daos_server.yml</code></a>
and example configuration files in the <a href="https://github.com/daos-stack/daos/tree/master/utils/config/examples">examples</a>
directory.</p>
<p>Any option supplied to <code>daos_server</code> as a command line option or flag will
take precedence over equivalent configuration file parameter.</p>
<p>For convenience, active parsed configuration values are written to a temporary
file for reference, and the location will be written to the log.</p>
<h4 id="configuration-file-options">Configuration File Options</h4>
<p>The example configuration file lists the default empty configuration, listing all the
options (living documentation of the config file). Live examples are
available at
<a href="https://github.com/daos-stack/daos/tree/master/utils/config">https://github.com/daos-stack/daos/tree/master/utils/config</a></p>
<p>The location of this configuration file is determined by first checking
for the path specified through the -o option of the daos_server command
line. Otherwise, /etc/daos_server.conf is used.</p>
<p>Refer to the example configuration file (<a href="https://github.com/daos-stack/daos/blob/master/utils/config/daos_server.yml">daos_server.yml</a>)
for latest information and examples.</p>
<h2 id="server-startup">Server Startup</h2>
<p>DAOS is currently switching from the PMIx-based server wire-up to a
self-contained bootstrap procedure. The new bootstrap procedure will be
available for DAOS v1.0 and will allow the DAOS servers to be started
individually (e.g. independently on each storage node via systemd) or
collectively (e.g. pdsh, mpirun or as a Kubernetes Pod). Meanwhile, servers
no longer have to be started by orterun, with a temporary limitation that if
one of them is restarted, the others must also be restarted.</p>
<h3 id="parallel-launcher">Parallel Launcher</h3>
<p>As stated above, orterun(1) is no longer required, provided the temporary
limitation is accommodated. The section still uses orterun as an example.</p>
<p>The list of storage nodes can be specified on the command line via the -H
option. The DAOS server and the application can be started separately.
Also, the DAOS server must be started with the --enable-recovery option
to support server failure. See the orterun(1) man page for additional options.</p>
<p>To start the DAOS server, run:</p>
<pre><code>orterun --map-by node --mca btl tcp,self --mca oob tcp -np &lt;num_servers&gt;
-H &lt;server_list&gt; --enable-recovery daos_server start -o &lt;config_file&gt;
</code></pre>

<p>The --enable-recovery is required for fault tolerance to guarantee that
the fault of one server does not cause the others to be stopped.</p>
<p>The --allow-run-as-root option can be added to the command line to
allow the daos_server to run with root privileges on each storage
nodes (for example when needing to perform privileged tasks relating
to storage format).</p>
<p>The content of the configuration file is documented in the next section
and a few examples are <a href="/src/utils/config/examples">available</a>.</p>
<h3 id="systemd-integration">Systemd Integration</h3>
<p>Systemd support for daos_server is still experimental as it will start the
daos_server and daos_io_server components in PMIXless mode, which is still in
development.</p>
<p>DAOS Server can be started as a systemd service. The DAOS Server
unit file is installed in the correct location when installing from RPMs.
If you wish to use systemd with a development build, you must copy the service
file from utils/systemd to /usr/lib/systemd/system. Once the file is copied
modify the ExecStart line to point to your in tree daos_server binary.</p>
<p>Once the service file is installed you can start daos_server
with the following commands:</p>
<pre><code class="bash">$ systemctl enable daos-server
$ systemctl start daos-server
</code></pre>

<p>To check the component status use:</p>
<pre><code class="bash">$ systemctl status daos-server
</code></pre>

<p>If DAOS Server failed to start, check the logs with:</p>
<pre><code class="bash">$ journalctl --unit daos-server
</code></pre>

<h3 id="kubernetes-pod">Kubernetes Pod</h3>
<p>DAOS service integration with Kubernetes is planned and will be
supported in a future DAOS version.</p>
<h3 id="internal-daos-control-server-components">Internal DAOS Control Server Components</h3>
<p>On start-up, the <code>daos_server</code> will create and initialize the following
components:</p>
<ul>
<li>
<p>gRPC server to handle requests over client API</p>
</li>
<li>
<p>dRPC server to handle requests from IO servers over the UNIX domain
socket</p>
</li>
<li>
<p>communication primitives for request/response to/from privileged binary
helper <code>daos_admin</code></p>
</li>
</ul>
<h2 id="storage-formatting">Storage Formatting</h2>
<p>When <code>daos_server</code> is started for the first time (and no SCM directory exists),
it enters "maintenance mode" and waits for a <code>dmg storage format</code> call to
be issued from the management tool.
This remote call will trigger the formatting of the locally attached storage on
the host for use with DAOS using the parameters defined in the server config file.</p>
<p><code>dmg -i -l &lt;host:port&gt;[,...] storage format</code> will normally be run on a login
node specifying a hostlist (<code>-l &lt;host:port&gt;[,...]</code>) of storage nodes with SCM/DCPM
modules and NVMe SSDs installed and prepared.</p>
<h3 id="scm-format">SCM Format</h3>
<p>When the command is run, the pmem kernel devices created on SCM/DCPM regions are
formatted and mounted based on the parameters provided in the server config file.</p>
<ul>
<li><code>scm_mount</code> specifies the location of the mountpoint to create.</li>
<li><code>scm_class</code> can be set to <code>ram</code> to use a tmpfs in the situation that no SCM/DCPM
is available (scm_size dictates the size of tmpfs in GB), when set to <code>dcpm</code> the device
specified under <code>scm_list</code> will be mounted at <code>scm_mount</code> path.</li>
</ul>
<h3 id="nvme-format">NVMe Format</h3>
<p>When the command is run, NVMe SSDs are formatted and set up to be used by DAOS
based on the parameters provided in the server config file.</p>
<p><code>bdev_class</code> can be set to <code>nvme</code> to use actual NVMe devices with SPDK for DAOS
storage.
Other <code>bdev_class</code> values can be used for emulation of NVMe storage as specified
in the server config file.
<code>bdev_list</code> identifies devices to use with a list of PCI addresses (this can be
populated after viewing results from <code>storage scan</code> command).</p>
<p>After the format command is run, the path specified by the server configuration
file <code>scm_mount</code> parameter should be mounted and should contain a file named
<code>daos_nvme.conf</code>.
The file should describe the devices with PCI addresses as listed in the
<code>bdev_list</code> parameter of the server config file.
The presence and contents of the file indicate that the specified NVMe SSDs have
been configured correctly for use with DAOS.</p>
<p>The contents of the NVMe SSDs listed in the server configuration file <code>bdev_list</code>
parameter will be reset on format.</p>
<h3 id="server-format">Server Format</h3>
<p>Before the format command is run, no DAOS metadata should exist under the
path specified by <code>scm_mount</code> parameter in the server configuration file.</p>
<p>After the <code>storage format</code> command is run, the path specified by the server
configuration file <code>scm_mount</code> parameter should be mounted and should contain
the necessary DAOS metadata indicating that the server has been formatted.</p>
<p>When starting, <code>daos_server</code> will skip <code>maintenance mode</code> and attempt to start
IO services if valid DAOS metadata is found in <code>scm_mount</code>.</p>
<h2 id="agent-configuration">Agent Configuration</h2>
<p>This section addresses how to configure the DAOS agents on the storage
nodes before starting it.</p>
<h3 id="agent-certificate-generation">Agent Certificate Generation</h3>
<p>The DAOS security framework relies on certificates to authenticate
administrators. The security infrastructure is currently under
development and will be delivered in DAOS v1.0. Initial support for certificates
has been added to DAOS and can be disabled either via the command line or in the
DAOS Agent configuration file. Currently, the easiest way to disable certificate
support is to pass the -i flag to daos_agent.</p>
<h3 id="agent-configuration-file">Agent Configuration File</h3>
<p>The <code>daos_agent</code> configuration file is parsed when starting the
<code>daos_agent</code> process. The configuration file location can be specified
on the command line (<code>daos_agent -h</code> for usage) or default location
(<code>install/etc/daos_agent.yml</code>).</p>
<p>Parameter descriptions are specified in <a href="https://github.com/daos-stack/daos/blob/master/utils/config/daos_agent.yml">daos_agent.yml</a>.</p>
<p>Any option supplied to <code>daos_agent</code> as a command line option or flag will
take precedence over equivalent configuration file parameter.</p>
<p>For convenience, active parsed config values are written to a temporary
file for reference, and the location will be written to the log.</p>
<p>The following section lists the format, options, defaults, and
descriptions available in the configuration file.</p>
<h4 id="configuration-file-options_1">Configuration File Options</h4>
<p>The example configuration file lists the default empty configuration listing all the
options (living documentation of the config file). Live examples are
available at
<a href="https://github.com/daos-stack/daos/tree/master/utils/config">https://github.com/daos-stack/daos/tree/master/utils/config</a></p>
<p>The location of this configuration file is determined by first checking
for the path specified through the -o option of the daos_agent command
line. Otherwise, /etc/daos_agent.conf is used.</p>
<p>Refer to the example configuration file (<a href="https://github.com/daos-stack/daos/blob/master/utils/config/daos_server.yml">daos_server.yml</a>) for latest information and examples.</p>
<h2 id="agent-startup">Agent Startup</h2>
<p>DAOS Agent is a standalone application to be run on each compute node.
It can be configured to use secure communications (default) or can be allowed
to communicate with the control plane over unencrypted channels. The following
example shows daos_agent being configured to operate in insecure mode due to
incomplete integration of certificate support as of the 0.6 release.</p>
<p>To start the DAOS Agent from the command line, run:</p>
<pre><code class="bash">$ daos_agent -i
</code></pre>

<p>Alternatively, the DAOS Agent can be started as a systemd service. The DAOS Agent
unit file is installed in the correct location when installing from RPMs.
If you wish to use systemd with a development build, you must copy the service
file from utils/systemd to /usr/lib/systemd/system. Once the file is copied
modify the ExecStart line to point to your in tree daos_agent binary.</p>
<p>Once the service file is installed, you can start daos_agent
with the following commands:</p>
<pre><code class="bash">$ systemctl enable daos-agent
$ systemctl start daos-agent
</code></pre>

<p>To check the component status use:</p>
<pre><code class="bash">$ systemctl status daos-agent
</code></pre>

<p>If DAOS Agent failed to start check the logs with:</p>
<pre><code class="bash">$ journalctl --unit daos-agent
</code></pre>

<h2 id="system-validation">System Validation</h2>
<p>To validate that the DAOS system is properly installed, the daos_test
suite can be executed. Ensure the DAOS Agent is configured and running before
running daos_test and that the DAOS_SINGLETON_CLI and CRT_ATTACH_INFO_PATH
environment variables are properly set as described <a href="#server-startup">here</a>.</p>
<pre><code>orterun -np &lt;num_clients&gt; --hostfile &lt;hostfile&gt; ./daos_test
</code></pre>

<p>daos_test requires at least 8GB of SCM (or DRAM with tmpfs) storage on
each storage node.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../administration/" class="btn btn-neutral float-right" title="System Administration">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../installation/" class="btn btn-neutral" title="Software Installation"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../installation/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../administration/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../search/main.js" defer></script>

</body>
</html>
