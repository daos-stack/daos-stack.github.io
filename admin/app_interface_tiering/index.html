<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <meta name="author" content="DAOS Project">
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>Applications Interface and Tiering - DAOS</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Applications Interface and Tiering";
    var mkdocs_page_input_path = "admin/app_interface_tiering.md";
    var mkdocs_page_url = "/admin/app_interface_tiering/";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> DAOS</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="../../index.md">Home</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Overview</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../storage_model/">Storage Model</a>
                </li>
                <li class="">
                    
    <a class="" href="../../terminology/">Terminology</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Administration Guide</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../intro/">Introduction</a>
                </li>
                <li class="">
                    
    <a class="" href="../architecture/">DAOS Architecture</a>
                </li>
                <li class="">
                    
    <a class="" href="../hardware/">Hardware Requirements</a>
                </li>
                <li class="">
                    
    <a class="" href="../installation/">Software Installation</a>
                </li>
                <li class="">
                    
    <a class="" href="../deployment/">System Deployment</a>
                </li>
                <li class="">
                    
    <a class="" href="../administration/">Administration</a>
                </li>
                <li class="">
                    
    <a class="" href="../pool_operations/">Pool Operations</a>
                </li>
                <li class=" current">
                    
    <a class="current" href="./">Applications Interface and Tiering</a>
    <ul class="subnav">
            
    <li class="toctree-l3"><a href="#application-interface-and-tiering">Application Interface and Tiering</a></li>
    
        <ul>
        
            <li><a class="toctree-l4" href="#daos-container-management">DAOS Container Management</a></li>
        
            <li><a class="toctree-l4" href="#native-programming-interface">Native Programming Interface</a></li>
        
            <li><a class="toctree-l4" href="#posix-filesystem">POSIX Filesystem</a></li>
        
            <li><a class="toctree-l4" href="#unified-namespace">Unified Namespace</a></li>
        
            <li><a class="toctree-l4" href="#hpc-io-middleware-support">HPC I/O Middleware Support</a></li>
        
            <li><a class="toctree-l4" href="#spark-support">Spark Support</a></li>
        
            <li><a class="toctree-l4" href="#data-migration">Data Migration</a></li>
        
        </ul>
    

    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../performance_tuning/">Performance Tuning</a>
                </li>
                <li class="">
                    
    <a class="" href="../troubleshooting/">Troubleshooting</a>
                </li>
                <li class="">
                    
    <a class="" href="../utilities_examples/">Utilities and Usage Examples</a>
                </li>
                <li class="">
                    
    <a class="" href="../env_variables/">Environment Variables</a>
                </li>
    </ul>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">DAOS</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Administration Guide &raquo;</li>
        
      
    
    <li>Applications Interface and Tiering</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/daos-stack/daos/edit/master/docs/admin/app_interface_tiering.md"> Edit on daos-stack/daos</a>
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="application-interface-and-tiering">Application Interface and Tiering</h1>
<h2 id="daos-container-management">DAOS Container Management</h2>
<p>DAOS containers are the unit of data management for users.</p>
<h3 id="container-creationdestroy">Container Creation/Destroy</h3>
<p>Containers can be created and destroyed through the daos_cont_create/destroy()
functions exported by the DAOS API. A user tool called <code>daos</code> is also
provided to manage containers.</p>
<p>To create a container:</p>
<pre><code>$ orterun -np 1 --ompi-server file:~/uri.txt daos container create --pool=a171434a-05a5-4671-8fe2-615aa0d05094 --svc=0
Successfully created container 008123fc-6b6c-4768-a88a-a2a5ef34a1a2
</code></pre>

<p>The container type (i.e. POSIX or HDF5) can be passed via the --type option.
As shown below, the pool UUID, container UUID and container attributes can be
stored in the extended attributes of a POSIX file or directory for convenience.
Then subsequent invocations of the daos tools just need to reference the path
to the POSIX file or directory.</p>
<pre><code>$ orterun -np 1 --ompi-server file:~/uri.txt daos container create --pool=a171434a-05a5-4671-8fe2-615aa0d05094 --svc=0 --path=/tmp/mycontainer --type=POSIX --oclass=large --chunk_size=4K
Successfully created container 419b7562-5bb8-453f-bd52-917c8f5d80d1 type POSIX
$ daos container query --svc=0 --path=/tmp/mycontainer
Pool UUID:      a171434a-05a5-4671-8fe2-615aa0d05094
Container UUID: 419b7562-5bb8-453f-bd52-917c8f5d80d1
Number of snapshots: 0
Latest Persistent Snapshot: 0
DAOS Unified Namespace Attributes on path /tmp/mycontainer:
Container Type: POSIX
Object Class:   large
Chunk Size:     4096
</code></pre>

<h3 id="container-properties">Container Properties</h3>
<p>At creation time, a list of container properties can be specified:</p>
<ul>
<li>
<p>DAOS_PROP_CO_LABEL is a string that a user can associate with a
    container. e.g. "Cat Pics" or "ResNet-50 training data"</p>
</li>
<li>
<p>DAOS_PROP_CO_LAYOUT_TYPE is the container type (POSIX, MPI-IO,
    HDF5, ...)</p>
</li>
<li>
<p>DAOS_PROP_CO_LAYOUT_VER is a version of the layout that can be
    used by I/O middleware and application to handle interoperability.</p>
</li>
<li>
<p>DAOS_PROP_CO_CSUM defines whether checksums are enabled or
    disabled and the checksum type used.</p>
</li>
<li>
<p>DAOS_PROP_CO_REDUN_FAC is the redundancy factor that drives the
    minimal data protection required for objects stored in the
    container. e.g. RF1 means no data protection, RF3 only allows 3-way
    replication or erasure code N+2.</p>
</li>
<li>
<p>DAOS_PROP_CO_REDUN_LVL is the fault domain level that should be
    used to place data redundancy information (e.g. storage nodes, racks
    ...). This information will be eventually consumed to determine object
    placement.</p>
</li>
<li>
<p>DAOS_PROP_CO_SNAPSHOT_MAX is the maximum number of snapshot to
    retain. When a new snapshot is taken and the threshold is reached,
    the oldest snapshot will be automatically deleted.</p>
</li>
<li>
<p>DAOS_PROP_CO_ACL is the list of ACL for the container.</p>
</li>
<li>
<p>DAOS_PROP_CO_COMPRESS and DAOS_PROP_CO_ENCRYPT are reserved to
    configure respectively compression and encryption. Those features
    are currently not on the roadmap.</p>
</li>
</ul>
<p>While those properties are currently stored persistently with container
metadata, many of them are still under development. The ability to modify some
of these properties on an existing container will also be eventually provided.</p>
<h3 id="container-snapshot">Container Snapshot</h3>
<p>Similar to container create/destroy, a container can be snapshotted through the
DAOS API by calling daos_cont_create_snap(). Additional functions are provided
to destroy and list container snapshots.</p>
<p>The API also provides the ability to subscribe to container snapshot events and
to rollback the content of a container to a previous snapshot, but those
operations are not yet fully implemented.</p>
<p>This section will be updated once support for container snapshot is supported by
the <code>daos</code> tool.</p>
<h3 id="container-user-attributes">Container User Attributes</h3>
<p>Similar to POSIX extended attributes, users can attach some metadata to each
container through the daos_cont_{list/get/set}_attr() API.</p>
<h3 id="container-acls">Container ACLs</h3>
<p>Support for per-container ACLs is scheduled for DAOS v1.2. Similar to pool ACLs,
container ACLs will implement a subset of the NFSv4 ACL standard. This feature
will be documented here once available.</p>
<h2 id="native-programming-interface">Native Programming Interface</h2>
<h3 id="building-against-the-daos-library">Building against the DAOS library</h3>
<p>To build an applications or I/O middleware against the native DAOS API, include
the daos.h header file in your program and link with -Ldaos. Examples are
available under src/tests.</p>
<h3 id="daos-api-reference">DAOS API Reference</h3>
<p>libdaos is written in C and uses Doxygen comments that are added to C header
files.</p>
<p>[TODO] Generate Doxygen document and add a link here.</p>
<h3 id="bindings-to-different-languages">Bindings to Different Languages</h3>
<p>API bindings to both Python<a href="https://github.com/daos-stack/daos/blob/master/src/utils/py/README.md">^1</a> and Go<a href="https://godoc.org/github.com/daos-stack/go-daos/pkg/daos">^2</a> languages are available.</p>
<h2 id="posix-filesystem">POSIX Filesystem</h2>
<p>A regular POSIX namespace can be encapsulated into a DAOS container.  This
capability is provided by the libdfs library that implements the file and
directory abstractions over the native libdaos library. The POSIX emulation can
be exposed to applications or I/O frameworks either directly (e.g. for
frameworks Spark or TensorFlow or benchmark like IOR or mdtest that support
different storage backend plugin) or transparently via a FUSE daemon combined
optionally with an interception library to address some of the FUSE performance
bottleneck by delivering full OS bypass for POSIX read/write operations.</p>
<h3 id="libdfs">libdfs</h3>
<p>DFS stands for DAOS File System and is a library that allows a DAOS container to
be accessed as a hierarchical POSIX namespace. It supports files, directories
and symbolic links, but not hard links. Access permissions are inherited from
the parent pool and not implemented on a per-file or per-directory basis.
setuid() and setgid() programs as well as supplementary groups are currently not
supported.</p>
<p>While libdfs can be tested from a single instance (i.e. single process or client
node if used through dfuse), special care is required when the same POSIX
container is mounted concurrently by multiple processes. Concurrent DFS mounts
are not recommended. Support for concurrency control is under development and
will be documented here once ready.</p>
<h3 id="dfuse">dfuse</h3>
<p>A fuse daemon called dfuse is provided to mount a POSIX container in the local
filesystem tree. dfuse exposes one mountpoint as a single DFS namespace with a
single pool and container and can be mounted by a regular use (provided that it
is granted access to the pool and container).
To mount an existing POSIX container with dfuse, run the following command:</p>
<pre><code>$ orterun -np 1 --ompi-server file:~/uri.txt dfuse -p a171434a-05a5-4671-8fe2-615aa0d05094 -s 0 -c 464e68ca-0a30-4a5f-8829-238e890899d2 -m /tmp/daos -S &amp;
[1] 157981
</code></pre>

<p>The UUID after -p and -c should be replaced with respectively the pool and
container UUID. -s should be followed by the pool svc rank list and -m is the
local directory where the mount point will be setup.
When done, the file system can be unmounted via fusermount:</p>
<pre><code>$ fusermount -u /tmp/daos
</code></pre>

<h3 id="libioil">libioil</h3>
<p>An interception library called libioil is under development. This library will
work in conjunction with dfuse and allow to intercept POSIX read(2) and write(2)
and issue the I/O operations directly from the application context through
libdaos and without any application changes.</p>
<p>Support for libioil is currently planned for DAOS v1.2.</p>
<h2 id="unified-namespace">Unified Namespace</h2>
<p>The DAOS tier can be tightly integrated with the Lustre parallel filesystem in
which DAOS containers will be represented through the Lustre namespace. This
capability is under development and is scheduled for DAOS v1.2.</p>
<h2 id="hpc-io-middleware-support">HPC I/O Middleware Support</h2>
<p>Several HPC I/O middleware libraries have been ported to the native API.</p>
<h3 id="mpi-io">MPI-IO</h3>
<p>DAOS has its own MPI-IO ROM ADIO driver located in a MPICH fork on GitHub:</p>
<p><a href="https://github.com/daos-stack/mpich">https://github.com/daos-stack/mpich</a></p>
<p>This driver has been submitted upstream for integration.</p>
<p>To build the MPI-IO driver:</p>
<ul>
<li>
<p>export MPI_LIB=""</p>
</li>
<li>
<p>download the mpich repo from above and switch to daos_adio branch</p>
</li>
<li>
<p>./autogen.sh</p>
</li>
<li>
<p>mkdir build; cd build</p>
</li>
<li>
<p>../configure --prefix=dir --enable-fortran=all --enable-romio
    --enable-cxx --enable-g=all --enable-debuginfo
    --with-file-system=ufs+daos --with-daos=dir --with-cart=dir</p>
</li>
<li>
<p>make -j8; make install</p>
</li>
</ul>
<p>Switch PATH and LD_LIBRARY_PATH where you want to build your client apps or libs
that use MPI to the above installed MPICH. Note that the DAOS server will still
need to be launched with OMPI's orterun. This is a unique situation where the
server uses OMPI and the clients will be launched with MPICH.</p>
<p>Build any client (HDF5, ior, mpi test suites) normally with the mpicc and mpich
library installed above (see child pages).</p>
<p>To run an example:</p>
<ol>
<li>Launch DAOS server(s) and create a pool as specified in the previous section.
   This will return a pool uuid "puuid" and service rank list "svcl"</li>
<li>At the client side, the following environment variables need to be set:<pre><code>export PATH=/path/to/mpich/install/bin:$PATH
export LD_LIBRARY_PATH=/path/to/mpich/install/lib:$LD_LIBRARY_PATH
export MPI_LIB=""
export CRT_ATTACH_INFO_PATH=/path/ (whatever was passed to daos_server start -a)
export DAOS_SINGLETON_CLI=1
</code></pre>
<ol>
<li>export DAOS_POOL=puuid; export DAOS_SVCL=svcl
This is just temporary till we have a better way of passing pool
connect info to MPI-IO and other middleware over DAOS.</li>
<li>Run the client application or test.</li>
</ol>
</li>
</ol>
<p>Limitations to the current implementation include:</p>
<ul>
<li>
<p>Incorrect MPI_File_set_size and MPI_File_get_size - This will be fixed in
    the future when DAOS correctly supports records enumeration after punch or
    key query for max/min key and recx.</p>
</li>
<li>
<p>Reading Holes does not return 0, but leaves the buffer untouched</p>
</li>
<li>
<p>No support for MPI file atomicity, preallocate, shared file pointers.</p>
</li>
</ul>
<h3 id="hdf5">HDF5</h3>
<p>A prototype version of a HDF5 DAOS connector is available. Please refer to the
DAOS VOL connector user guide<a href="https://bitbucket.hdfgroup.org/projects/HDF5VOL/repos/daos-vol/browse/README.md">^3</a> for instructions on how to build and use it.</p>
<h2 id="spark-support">Spark Support</h2>
<p>Spark integration with libdfs is under development and is scheduled for DAOS
v1.0 or v1.2.</p>
<h2 id="data-migration">Data Migration</h2>
<h3 id="migration-tofrom-a-posix-filesystem">Migration to/from a POSIX filesystem</h3>
<p>A dataset mover tool is under consideration to move a snapshot of a POSIX,
MPI-IO or HDF5 container to a POSIX filesystem and vice versa. The copy will be
performed at the POSIX or HDF5 level. The resulting HDF5 file over the POSIX
filesystem will be accessible through the native HDF5 connector with the POSIX
VFD.</p>
<p>The first version of the mover tool is currently scheduled for DAOS v1.4.</p>
<h3 id="container-parking">Container Parking</h3>
<p>The mover tool will also eventually support the ability to serialize and
deserialize a DAOS container to a set of POSIX files that can be stored or
"parked" in an external POSIX filesystem. This transformation is agnostic to the
data model and container type and will retain all DAOS internal metadata.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../performance_tuning/" class="btn btn-neutral float-right" title="Performance Tuning">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../pool_operations/" class="btn btn-neutral" title="Pool Operations"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../pool_operations/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../performance_tuning/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../search/main.js" defer></script>

</body>
</html>
