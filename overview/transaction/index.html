<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="author" content="DAOS Project">
    <link rel="canonical" href="http://daos.io/overview/transaction/">
    <link rel="shortcut icon" href="../../img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>Transaction Model - DAOS</title>
    <link href="../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../css/highlight.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../js/jquery-3.2.1.min.js"></script>
    <script src="../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "Transaction Model", url: "#_top", children: [
              {title: "Epoch &amp; Timestamp Ordering", url: "#epoch-timestamp-ordering" },
              {title: "Container Snapshot", url: "#container-snapshot" },
              {title: "Distributed Transactions", url: "#distributed-transactions" },
          ]},
        ];

    </script>
    <script src="../../js/base.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../fault/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../fault/" class="btn btn-xs btn-link">
        Fault Model
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../storage/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../storage/" class="btn btn-xs btn-link">
        Storage Model
      </a>
    </div>
    
  </div>

    

    <p><a id="4.2"></a></p>
<h1 id="transaction-model">Transaction Model</h1>
<p>The DAOS API supports distributed transactions that allow any update operations against objects belonging to the same container to be combined into a single ACID transaction. Distributed consistency is provided via a lockless optimistic concurrency control mechanism based on multi-version timestamp ordering. DAOS transactions are serializable and can be used on an ad-hoc basis for parts of the datasets that need it.</p>
<p>The DAOS versioning mechanism allows creating persistent container snapshots which provide point-in-time distributed consistent views of a container which can be used to build producer-consumer pipeline.</p>
<p><a id="4.2.1"></a></p>
<h2 id="epoch-timestamp-ordering">Epoch &amp; Timestamp Ordering</h2>
<p>Each DAOS I/O operation is tagged with a timestamp called epoch. An epoch is a 64-bit integer that integrates both logical and physical clocks (see <a href="https://cse.buffalo.edu/tech-reports/2014-04.pdf">HLC paper</a>). The DAOS API provides helper functions to convert an epoch to traditional POSIX time (i.e., struct timespec, see clock_gettime(3)).</p>
<p><a id="4.2.2"></a></p>
<h2 id="container-snapshot">Container Snapshot</h2>
<p>As shown in the <a href="#f4.4">figure</a> below, the content of a container can be snapshot at any time.</p>
<p><a id="f4.4"></a>
<img alt="../graph/container_snapshots.png" src="../../graph/container_snapshots.png" title="Example of Container Snapshots" /></p>
<p>DAOS snapshots are very lightweight and are tagged with the epoch associated with the time when the snapshot was created. Once successfully created, a snapshot remains readable until it is explicitly destroyed. The content of a container can be rolled back to a particular snapshot.</p>
<p>The container snapshot feature allows supporting native producer/consumer pipeline as represented in the diagram below.</p>
<p><img alt="../graph/producer_consumer.png" src="../../graph/producer_consumer.png" title="Producer/Consumer Workflow with DAOS Containers" /></p>
<p>The producer will generate a snapshot once a consistent version of the dataset has been successfully written. The consumer applications may subscribe to container snapshot events so that new updates can be processed as the producer commits them. The immutability of the snapshots guarantees that the consumer sees consistent data, even while the producer continues with new updates. Both the producer and consumer indeed operate on different versions of the container and do not need any serialization. Once the producer generates a new version of the dataset, the consumer may query the differences between the two snapshots and process only the incremental changes.</p>
<p><a id="4.2.3"></a></p>
<h2 id="distributed-transactions">Distributed Transactions</h2>
<p>Unlike POSIX, the DAOS API does not impose any worst-case concurrency control mechanism to address conflicting I/O operations. Instead, individual I/O operations are tagged with a different epoch and applied in epoch order, regardless of execution order. This baseline model delivers the maximum scalability and performance to data models and applications that do not generate conflicting I/O workload. Typical examples are collective MPI-IO operations, POSIX file read/write or HDF5 dataset read/write.</p>
<p>For parts of the data model that require conflict serialization, DAOS provides distributed serializable transaction based on multi-version concurrency control. Transactions are typically needed when different user process can overwrite the value associated with a dkey/akey pair. Examples are a SQL database over DAOS or a consistent POSIX namespace accessed concurrently by uncoordinated clients. All I/O operations (include reads) submitted in the context of the same operation will use the same epoch. The DAOS transaction mechanism automatically detects the traditional read/write, write/read and write/write conflicts and aborts one of the conflicting transactions that have to be restarted by the user (i.e., transaction fails to commit with -DER_RESTART).</p>
<p>In the initial implementation, the transaction API has the following limitations that will be addressed in future DAOS versions:</p>
<ul>
<li>no support for the array API</li>
<li>transactional object update and key-value put operations are not visible via object fetch/list and key-value get/list operations executed in the context of the same transaction.</li>
</ul>

  <br>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../fault/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../fault/" class="btn btn-xs btn-link">
        Fault Model
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../storage/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../storage/" class="btn btn-xs btn-link">
        Storage Model
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="col-md-12 wm-page-content">
      <p>
        <a href="https://github.com/daos-stack/daos/edit/master/docs/overview/transaction.md">Edit on daos-stack/daos</a>
      </p>
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="https://github.com/gristlabs/mkdocs-windmill">Windmill</a> theme by Grist Labs.</p>
</footer>

</body>
</html>