<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <meta name="author" content="DAOS Project">
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>Transaction Model - DAOS</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Transaction Model";
    var mkdocs_page_input_path = "overview/transaction.md";
    var mkdocs_page_url = "/overview/transaction/";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> DAOS</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="../..">Home</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Overview</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../terminology/">Terminology</a>
                </li>
                <li class="">
                    
    <a class="" href="../storage/">Storage Model</a>
                </li>
                <li class=" current">
                    
    <a class="current" href="./">Transaction Model</a>
    <ul class="subnav">
            
    <li class="toctree-l3"><a href="#transaction-model">Transaction Model</a></li>
    
        <ul>
        
            <li><a class="toctree-l4" href="#epoch-timestamp-ordering">Epoch &amp; Timestamp Ordering</a></li>
        
            <li><a class="toctree-l4" href="#container-snapshot">Container Snapshot</a></li>
        
            <li><a class="toctree-l4" href="#distributed-transactions">Distributed Transactions</a></li>
        
        </ul>
    

    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../fault/">Fault Model</a>
                </li>
                <li class="">
                    
    <a class="" href="../security/">Security Model</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Administration Guide</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../admin/intro/">Introduction</a>
                </li>
                <li class="">
                    
    <a class="" href="../../admin/architecture/">DAOS Architecture</a>
                </li>
                <li class="">
                    
    <a class="" href="../../admin/hardware/">Hardware Requirements</a>
                </li>
                <li class="">
                    
    <a class="" href="../../admin/installation/">Software Installation</a>
                </li>
                <li class="">
                    
    <a class="" href="../../admin/deployment/">System Deployment</a>
                </li>
                <li class="">
                    
    <a class="" href="../../admin/administration/">Administration</a>
                </li>
                <li class="">
                    
    <a class="" href="../../admin/pool_operations/">Pool Operations</a>
                </li>
                <li class="">
                    
    <a class="" href="../../admin/app_interface_tiering/">Applications Interface and Tiering</a>
                </li>
                <li class="">
                    
    <a class="" href="../../admin/performance_tuning/">Performance Tuning</a>
                </li>
                <li class="">
                    
    <a class="" href="../../admin/troubleshooting/">Troubleshooting</a>
                </li>
                <li class="">
                    
    <a class="" href="../../admin/utilities_examples/">Utilities and Usage Examples</a>
                </li>
                <li class="">
                    
    <a class="" href="../../admin/env_variables/">Environment Variables</a>
                </li>
    </ul>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">DAOS</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Overview &raquo;</li>
        
      
    
    <li>Transaction Model</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/daos-stack/daos/edit/master/docs/overview/transaction.md"> Edit on daos-stack/daos</a>
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <p><a id="4.2"></a></p>
<h1 id="transaction-model">Transaction Model</h1>
<p>The DAOS API supports distributed transactions that allow any update operations against objects belonging to the same container to be combined into a single ACID transaction. Distributed consistency is provided via a lockless optimistic concurrency control mechanism based on multi-version timestamp ordering. DAOS transactions are serializable and can be used on an ad-hoc basis for parts of the datasets that need it.</p>
<p>The DAOS versioning mechanism allows creating persistent container snapshots which provide point-in-time distributed consistent views of a container which can be used to build producer-consumer pipeline.</p>
<p><a id="4.2.1"></a></p>
<h2 id="epoch-timestamp-ordering">Epoch &amp; Timestamp Ordering</h2>
<p>Each DAOS I/O operation is tagged with a timestamp called epoch. An epoch is a 64-bit integer that integrates both logical and physical clocks (see <a href="https://cse.buffalo.edu/tech-reports/2014-04.pdf">HLC paper</a>). The DAOS API provides helper functions to convert an epoch to traditional POSIX time (i.e., struct timespec, see clock_gettime(3)).</p>
<p><a id="4.2.2"></a></p>
<h2 id="container-snapshot">Container Snapshot</h2>
<p>As shown in the <a href="#f4.4">figure</a> below, the content of a container can be snapshot at any time.</p>
<p><a id="f4.4"></a>
<img alt="../graph/container_snapshots.png" src="../../graph/container_snapshots.png" title="Example of Container Snapshots" /></p>
<p>DAOS snapshots are very lightweight and are tagged with the epoch associated with the time when the snapshot was created. Once successfully created, a snapshot remains readable until it is explicitly destroyed. The content of a container can be rolled back to a particular snapshot.</p>
<p>The container snapshot feature allows supporting native producer/consumer pipeline as represented in the diagram below.</p>
<p><img alt="../graph/producer_consumer.png" src="../../graph/producer_consumer.png" title="Producer/Consumer Workflow with DAOS Containers" /></p>
<p>The producer will generate a snapshot once a consistent version of the dataset has been successfully written. The consumer applications may subscribe to container snapshot events so that new updates can be processed as the producer commits them. The immutability of the snapshots guarantees that the consumer sees consistent data, even while the producer continues with new updates. Both the producer and consumer indeed operate on different versions of the container and do not need any serialization. Once the producer generates a new version of the dataset, the consumer may query the differences between the two snapshots and process only the incremental changes.</p>
<p><a id="4.2.3"></a></p>
<h2 id="distributed-transactions">Distributed Transactions</h2>
<p>Unlike POSIX, the DAOS API does not impose any worst-case concurrency control mechanism to address conflicting I/O operations. Instead, individual I/O operations are tagged with a different epoch and applied in epoch order, regardless of execution order. This baseline model delivers the maximum scalability and performance to data models and applications that do not generate conflicting I/O workload. Typical examples are collective MPI-IO operations, POSIX file read/write or HDF5 dataset read/write.</p>
<p>For parts of the data model that require conflict serialization, DAOS provides distributed serializable transaction based on multi-version concurrency control. Transactions are typically needed when different user process can overwrite the value associated with a dkey/akey pair. Examples are a SQL database over DAOS or a consistent POSIX namespace accessed concurrently by uncoordinated clients. All I/O operations (include reads) submitted in the context of the same operation will use the same epoch. The DAOS transaction mechanism automatically detects the traditional read/write, write/read and write/write conflicts and aborts one of the conflicting transactions that have to be restarted by the user (i.e., transaction fails to commit with -DER_RESTART).</p>
<p>In the initial implementation, the transaction API has the following limitations that will be addressed in future DAOS versions:</p>
<ul>
<li>no support for the array API</li>
<li>transactional object update and key-value put operations are not visible via object fetch/list and key-value get/list operations executed in the context of the same transaction.</li>
</ul>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../fault/" class="btn btn-neutral float-right" title="Fault Model">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../storage/" class="btn btn-neutral" title="Storage Model"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../storage/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../fault/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../search/main.js" defer></script>

</body>
</html>
